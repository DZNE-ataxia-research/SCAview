{"ast":null,"code":"import _toConsumableArray from\"/idsn/git/July_22/PostIDSN-Viewer/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/idsn/git/July_22/PostIDSN-Viewer/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/idsn/git/July_22/PostIDSN-Viewer/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import'./Filter.css';import Radio from'@material-ui/core/Radio';import RadioGroup from'@material-ui/core/RadioGroup';import FormControlLabel from'@material-ui/core/FormControlLabel';import Button from'@material-ui/core/Button';import TextField from'@material-ui/core/TextField';import Table from'@material-ui/core/Table';import TableBody from'@material-ui/core/TableBody';import TableCell from'@material-ui/core/TableCell';import TableContainer from'@material-ui/core/TableContainer';import TableHead from'@material-ui/core/TableHead';import TableRow from'@material-ui/core/TableRow';import Card from'@material-ui/core/Card';import CardContent from'@material-ui/core/CardContent';import CardHeader from'@material-ui/core/CardHeader';import IconButton from'@material-ui/core/IconButton';//import * as Attributes from '../services/Attributes_old';\nimport CloseIcon from'@material-ui/icons/Close';import DeleteIcon from'@material-ui/icons/Delete';// STRUCTURES\nexport var Concept;(function(Concept){Concept[Concept[\"patient\"]=1]=\"patient\";Concept[Concept[\"visit\"]=2]=\"visit\";})(Concept||(Concept={}));// CONFIG\nexport var defaultConcept=Concept.patient;var conceptOptions=[{label:'Patient',value:Concept.patient},{label:'Visit',value:Concept.visit}];// PROPS\nvar Filter=function Filter(props){React.useEffect(function(){onPropsChanged();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[props]);// STATES\n//constraintsTableState\nvar _useState=useState([]),_useState2=_slicedToArray(_useState,2),constraintsTableState=_useState2[0],setConstraintsTableState=_useState2[1];//newSubgroupState\nvar _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),newSubgroupState=_useState4[0],setNewSubgroupState=_useState4[1];//checkRadioState\nvar _useState5=useState(),_useState6=_slicedToArray(_useState5,2),selectSubgroupState=_useState6[0],setSelectSubgroupState=_useState6[1];// HANDLERS\nvar onPropsChanged=function onPropsChanged(){setConstraintsTableState(props.filter.constraints.map(function(constraint){return{attribute:constraint.attribute,lower:constraint.lower?constraint.lower.toFixed(1):'',upper:constraint.upper?constraint.upper.toFixed(1):'',items:constraint.items.join(', ')};}));};var onConstraintChanging=function onConstraintChanging(attribute,constraint){var newConstraint=_objectSpread(_objectSpread({attribute:'',lower:'',upper:'',items:''},constraintsTableState.find(function(constraint){return constraint.attribute===attribute;})),constraint);setConstraintsTableState([].concat(_toConsumableArray(constraintsTableState.filter(function(constraint){return constraint.attribute!==attribute;})),[newConstraint]));};var onConstraintsChanged=function onConstraintsChanged(){props.onFilterChanged({constraints:constraintsTableState.map(function(constraint){return{attribute:constraint.attribute,lower:constraint.lower?+constraint.lower:null,upper:constraint.upper?+constraint.upper:null,items:constraint.items.length>0?constraint.items.split(', '):[]};})});setSelectSubgroupState(null);};var onConstraintsReset=function onConstraintsReset(){props.onFilterChanged({constraints:[]});setSelectSubgroupState(null);};var onConstraintRemove=function onConstraintRemove(attribute){props.onFilterChanged({constraints:props.filter.constraints.filter(function(constraint){return constraint.attribute!==attribute;})});setSelectSubgroupState(null);};// HELPER\n// RENDER\nreturn/*#__PURE__*/React.createElement(Card,{className:\"filter\"},/*#__PURE__*/React.createElement(CardHeader,{subheader:\"Filter\",action:/*#__PURE__*/React.createElement(IconButton,{size:\"small\",\"aria-label\":\"close\",onClick:function onClick(){props.onClose();},className:\"grid__item--close\"},/*#__PURE__*/React.createElement(CloseIcon,null))}),/*#__PURE__*/React.createElement(CardContent,{className:\"filter__content\"},/*#__PURE__*/React.createElement(\"div\",{className:\"form__title\"},\"Filter Settings\"),/*#__PURE__*/React.createElement(RadioGroup,{row:true,value:props.filter.concept,onChange:function onChange(event){props.onFilterChanged({concept:+event.target.value});}},conceptOptions.map(function(concept){return/*#__PURE__*/React.createElement(FormControlLabel,{key:concept.value,value:concept.value,control:/*#__PURE__*/React.createElement(Radio,{color:\"primary\"}),label:concept.label});})),!!constraintsTableState.length&&/*#__PURE__*/React.createElement(TableContainer,null,/*#__PURE__*/React.createElement(Table,{size:\"small\"},/*#__PURE__*/React.createElement(TableHead,null,/*#__PURE__*/React.createElement(TableRow,null,/*#__PURE__*/React.createElement(TableCell,null,\"Attribute\"),/*#__PURE__*/React.createElement(TableCell,null,\"Lower\"),/*#__PURE__*/React.createElement(TableCell,null,\"Upper\"),/*#__PURE__*/React.createElement(TableCell,null,\"Items\"),/*#__PURE__*/React.createElement(TableCell,null))),/*#__PURE__*/React.createElement(TableBody,null,constraintsTableState.map(function(constraint){return/*#__PURE__*/React.createElement(TableRow,{key:constraint.attribute},/*#__PURE__*/React.createElement(TableCell,null,props.getTooltip(constraint.attribute)),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(TextField,{value:constraint.lower,disabled:!!constraint.items,onChange:function onChange(event){onConstraintChanging(constraint.attribute,{lower:event.target.value});},onBlur:function onBlur(){return onConstraintsChanged();},onKeyUp:function onKeyUp(event){if(event.key==='Enter'){onConstraintsChanged();}}})),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(TextField,{value:constraint.upper,disabled:!!constraint.items,onChange:function onChange(event){onConstraintChanging(constraint.attribute,{upper:event.target.value});},onBlur:function onBlur(){return onConstraintsChanged();},onKeyUp:function onKeyUp(event){if(event.key==='Enter'){onConstraintsChanged();}}})),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(TextField,{value:constraint.items,disabled:!constraint.items,onChange:function onChange(event){onConstraintChanging(constraint.attribute,{items:event.target.value});},onBlur:function onBlur(){return onConstraintsChanged();},onKeyUp:function onKeyUp(event){if(event.key==='Enter'){onConstraintsChanged();}}})),/*#__PURE__*/React.createElement(TableCell,null,/*#__PURE__*/React.createElement(IconButton,{size:\"small\",\"aria-label\":\"remove\",onClick:function onClick(){onConstraintRemove(constraint.attribute);}},/*#__PURE__*/React.createElement(DeleteIcon,null))));})))),/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",size:\"small\",onClick:onConstraintsReset},\"Reset filters\"),/*#__PURE__*/React.createElement(\"div\",{className:\"form__title\"},\"Subgroup Definitions\"),/*#__PURE__*/React.createElement(\"div\",{className:\"input-group\"},/*#__PURE__*/React.createElement(TextField,{value:newSubgroupState,label:\"Name\",onChange:function onChange(event){setNewSubgroupState(event.target.value);},InputLabelProps:{shrink:true},onKeyUp:function onKeyUp(event){if(event.key==='Enter'){props.onSubgroupDefine({name:newSubgroupState,constraints:props.filter.constraints});setNewSubgroupState('');}}}),/*#__PURE__*/React.createElement(Button,{variant:\"contained\",color:\"primary\",size:\"small\",onClick:function onClick(){var subgroup={name:newSubgroupState,constraints:props.filter.constraints};props.onSubgroupDefine(subgroup);setNewSubgroupState('');setSelectSubgroupState(subgroup);}},\"Define\")),!!props.subgroups.length&&/*#__PURE__*/React.createElement(RadioGroup,{onChange:function onChange(event){var subgroup=props.subgroups.find(function(subgroup){return subgroup.name===event.target.value;});setSelectSubgroupState(subgroup);props.onSubgroupActivate(event.target.value);},className:\"subgroups\"},props.subgroups.map(function(subgroup){return/*#__PURE__*/React.createElement(FormControlLabel,{key:subgroup.name,value:subgroup.name,control:/*#__PURE__*/React.createElement(Radio,{color:\"primary\",checked:subgroup===selectSubgroupState}),label:/*#__PURE__*/React.createElement(\"div\",{className:\"subgroup__label\"},/*#__PURE__*/React.createElement(\"span\",null,subgroup.name),/*#__PURE__*/React.createElement(IconButton,{size:\"small\",\"aria-label\":\"remove\",onClick:function onClick(){props.onSubgroupDelete(subgroup.name);}},/*#__PURE__*/React.createElement(DeleteIcon,null)))});}))));};export default Filter;","map":{"version":3,"sources":["/idsn/git/July_22/PostIDSN-Viewer/src/containers/Filter.tsx"],"names":["React","useState","Radio","RadioGroup","FormControlLabel","Button","TextField","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Card","CardContent","CardHeader","IconButton","CloseIcon","DeleteIcon","Concept","defaultConcept","patient","conceptOptions","label","value","visit","Filter","props","useEffect","onPropsChanged","constraintsTableState","setConstraintsTableState","newSubgroupState","setNewSubgroupState","selectSubgroupState","setSelectSubgroupState","filter","constraints","map","constraint","attribute","lower","toFixed","upper","items","join","onConstraintChanging","newConstraint","find","onConstraintsChanged","onFilterChanged","length","split","onConstraintsReset","onConstraintRemove","onClose","concept","event","target","getTooltip","key","shrink","onSubgroupDefine","name","subgroup","subgroups","onSubgroupActivate","onSubgroupDelete"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport './Filter.css';\nimport Radio from '@material-ui/core/Radio';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport IconButton from '@material-ui/core/IconButton';\n//import * as Attributes from '../services/Attributes_old';\n\nimport { Datum } from 'plotly.js';\nimport CloseIcon from '@material-ui/icons/Close';\nimport DeleteIcon from '@material-ui/icons/Delete';\n\n// STRUCTURES\n\nexport enum Concept {\n  patient = 1,\n  visit = 2,\n}\n\ninterface Constraint {\n  attribute: string;\n  lower: number | null;\n  upper: number | null;\n  items: Datum[];\n}\n\ninterface ConstraintRow {\n  attribute: string;\n  lower: string;\n  upper: string;\n  items: string;\n}\n\nexport interface Subgroup {\n  name: string;\n  constraints: Constraint[];\n}\n\nexport interface FilterState {\n  concept: Concept;\n  constraints: Constraint[];\n}\n\n// CONFIG\n\nexport const defaultConcept = Concept.patient;\n\nconst conceptOptions = [\n  { label: 'Patient', value: Concept.patient },\n  { label: 'Visit', value: Concept.visit },\n];\n\n// PROPS\n\ninterface Props {\n  filter: FilterState;\n  subgroups: Subgroup[];\n  onFilterChanged: (filter: Partial<FilterState>) => void;\n  onSubgroupDefine: (subgroup: Subgroup) => void;\n  onSubgroupDelete: (name: string) => void;\n  onSubgroupActivate: (name: string) => void;\n  onClose: () => void;\n  getTooltip: (attribute_ : string) => string\n}\n\nconst Filter: React.FunctionComponent<Props> = props => {\n  React.useEffect(() => {\n    onPropsChanged();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props]);\n\n  // STATES\n\n  //constraintsTableState\n  const [constraintsTableState, setConstraintsTableState] = useState<\n    ConstraintRow[]\n  >([]);\n\n  //newSubgroupState\n  const [newSubgroupState, setNewSubgroupState] = useState<string>('');\n\n  //checkRadioState\n  const [selectSubgroupState, setSelectSubgroupState] = useState<Subgroup | null>();\n\n  // HANDLERS\n\n  const onPropsChanged = () => {\n    \n    setConstraintsTableState(\n      props.filter.constraints.map(constraint => {\n        return {\n          attribute: constraint.attribute,\n          lower: constraint.lower ? constraint.lower.toFixed(1) : '',\n          upper: constraint.upper ? constraint.upper.toFixed(1) : '',\n          items: constraint.items.join(', '),\n        };\n      }),\n    );\n  };\n\n  const onConstraintChanging = (\n    attribute: string,\n    constraint: Partial<ConstraintRow>,\n  ) => {\n    const newConstraint: ConstraintRow = {\n      attribute: '',\n      lower: '',\n      upper: '',\n      items: '',\n      ...constraintsTableState.find(\n        constraint => constraint.attribute === attribute,\n      ),\n      ...constraint,\n    };\n    setConstraintsTableState([\n      ...constraintsTableState.filter(\n        constraint => constraint.attribute !== attribute,\n      ),\n      newConstraint,\n    ]);\n  };\n\n  const onConstraintsChanged = () => {\n    props.onFilterChanged({\n      constraints: constraintsTableState.map(constraint => {\n        return {\n          attribute: constraint.attribute,\n          lower: constraint.lower ? +constraint.lower : null,\n          upper: constraint.upper ? +constraint.upper : null,\n          items:\n            constraint.items.length > 0 ? constraint.items.split(', ') : [],\n        };\n      }),\n    });\n    setSelectSubgroupState(null);\n  };\n\n  const onConstraintsReset = () => {\n    props.onFilterChanged({ constraints: [] });\n    setSelectSubgroupState(null);\n  };\n\n  const onConstraintRemove = (attribute: string) => {\n    props.onFilterChanged({\n      constraints: props.filter.constraints.filter(\n        constraint => constraint.attribute !== attribute,\n      ),\n    });\n    setSelectSubgroupState(null);\n  };\n\n  // HELPER\n\n  // RENDER\n\n  return (\n    <Card className=\"filter\">\n      <CardHeader\n        subheader=\"Filter\"\n        action={\n          <IconButton\n            size=\"small\"\n            aria-label=\"close\"\n            onClick={() => {\n              props.onClose();\n            }}\n            className=\"grid__item--close\"\n          >\n            <CloseIcon />\n          </IconButton>\n        }\n      />\n      <CardContent className=\"filter__content\">\n        <div className=\"form__title\">Filter Settings</div>\n        <RadioGroup\n          row\n          value={props.filter.concept}\n          onChange={event => {\n            props.onFilterChanged({ concept: +event.target.value });\n          }}\n        >\n          {conceptOptions.map(concept => (\n            <FormControlLabel\n              key={concept.value}\n              value={concept.value}\n              control={<Radio color=\"primary\" />}\n              label={concept.label}\n            />\n          ))}\n        </RadioGroup>\n        {!!constraintsTableState.length && (\n          <TableContainer>\n            <Table size=\"small\">\n              <TableHead>\n                <TableRow>\n                  <TableCell>Attribute</TableCell>\n                  <TableCell>Lower</TableCell>\n                  <TableCell>Upper</TableCell>\n                  <TableCell>Items</TableCell>\n                  <TableCell></TableCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {constraintsTableState.map(constraint => (\n                  <TableRow key={constraint.attribute}>\n                    <TableCell>\n                      {props.getTooltip(constraint.attribute)}\n                    </TableCell>\n                    <TableCell>\n                      <TextField\n                        value={constraint.lower}\n                        disabled={!!constraint.items}\n                        onChange={event => {\n                          onConstraintChanging(constraint.attribute, {\n                            lower: event.target.value,\n                          });\n                        }}\n                        onBlur={() => onConstraintsChanged()}\n                        onKeyUp={event => {\n                          if (event.key === 'Enter') {\n                            onConstraintsChanged();\n                          }\n                        }}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      <TextField\n                        value={constraint.upper}\n                        disabled={!!constraint.items}\n                        onChange={event => {\n                          onConstraintChanging(constraint.attribute, {\n                            upper: event.target.value,\n                          });\n                        }}\n                        onBlur={() => onConstraintsChanged()}\n                        onKeyUp={event => {\n                          if (event.key === 'Enter') {\n                            onConstraintsChanged();\n                          }\n                        }}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      <TextField\n                        value={constraint.items}\n                        disabled={!constraint.items}\n                        onChange={event => {\n                          onConstraintChanging(constraint.attribute, {\n                            items: event.target.value,\n                          });\n                        }}\n                        onBlur={() => onConstraintsChanged()}\n                        onKeyUp={event => {\n                          if (event.key === 'Enter') {\n                            onConstraintsChanged();\n                          }\n                        }}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      <IconButton\n                        size=\"small\"\n                        aria-label=\"remove\"\n                        onClick={() => {\n                          onConstraintRemove(constraint.attribute);\n                        }}\n                      >\n                        <DeleteIcon />\n                      </IconButton>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </TableContainer>\n        )}\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          size=\"small\"\n          onClick={onConstraintsReset}\n        >\n          Reset filters\n        </Button>\n        <div className=\"form__title\">Subgroup Definitions</div>\n        <div className=\"input-group\">\n          <TextField\n            value={newSubgroupState}\n            label=\"Name\"\n            onChange={event => {\n              setNewSubgroupState(event.target.value);\n            }}\n            InputLabelProps={{\n              shrink: true,\n            }}\n            onKeyUp={event => {\n              if (event.key === 'Enter') {\n                props.onSubgroupDefine({\n                  name: newSubgroupState,\n                  constraints: props.filter.constraints,\n                });\n                setNewSubgroupState('');\n              }\n            }}\n          />\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            size=\"small\"\n            onClick={() => {\n              const subgroup = {\n                name: newSubgroupState,\n                constraints: props.filter.constraints,\n              };\n              props.onSubgroupDefine(subgroup);\n              setNewSubgroupState('');\n              setSelectSubgroupState(subgroup);\n            }}\n          >\n            Define\n          </Button>\n        </div>\n        {!!props.subgroups.length && (\n          <RadioGroup\n            onChange={event => {\n              const subgroup = props.subgroups.find(subgroup => subgroup.name === event.target.value);\n              setSelectSubgroupState(subgroup);\n              props.onSubgroupActivate(event.target.value);\n            }}\n            className=\"subgroups\"\n          >\n            {props.subgroups.map(subgroup => (\n              <FormControlLabel\n                key={subgroup.name}\n                value={subgroup.name}\n                control={<Radio color=\"primary\" checked={subgroup === selectSubgroupState}/>}\n                label={\n                  <div className=\"subgroup__label\">\n                    <span>{subgroup.name}</span>\n                    <IconButton\n                      size=\"small\"\n                      aria-label=\"remove\"\n                      onClick={() => {\n                        props.onSubgroupDelete(subgroup.name);\n                      }}\n                    >\n                      <DeleteIcon />\n                    </IconButton>\n                  </div>\n                }\n              />\n            ))}\n          </RadioGroup>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default Filter;\n"]},"metadata":{},"sourceType":"module"}