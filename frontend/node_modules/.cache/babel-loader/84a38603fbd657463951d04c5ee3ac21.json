{"ast":null,"code":"var _jsxFileName = \"/Users/philippwegner/Desktop/UKB/git/PostIDSN-Viewer/src/containers/Viewer.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport Grid from '../components/Grid';\nimport Plot from '../components/Plot';\nimport localStorage from '../services/LocalStorage';\nimport backend, { Fit, Legend } from '../services/Backend';\nimport utilities from '../services/Utilities';\nimport Filter, { defaultConcept } from './Filter';\nimport Configuration, { DiagramType, initialDiagramType, Visit } from './Controls';\nimport Button from '@material-ui/core/Button';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport IconButton from '@material-ui/core/IconButton';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport './Viewer.css';\nimport AddIcon from '@material-ui/icons/Add';\nimport AspectRatioIcon from '@material-ui/icons/AspectRatio';\nimport ReplayIcon from '@material-ui/icons/Replay';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport EditIcon from '@material-ui/icons/Edit';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Alert from '@material-ui/lab/Alert';\nimport Snackbar from '@material-ui/core/Snackbar'; // CONFIG\n\nexport const initialControls = {\n  identifier: '',\n  type: initialDiagramType,\n  attX: '',\n  attY: '',\n  attC: '',\n  dt: 0,\n  visit: Visit.all,\n  followup: 0,\n  tolerance: 0,\n  norm: false,\n  stack: false,\n  fit: Fit.none,\n  legend: Legend.legend,\n  bins: 0\n}; // PROPS\n\nconst Viewer = props => {\n  var _localStorage$getObje, _localStorage$getObje2, _localStorage$getObje3, _localStorage$getObje4, _localStorage$getObje5, _localStorage$getObje6, _plotControlsState$vi;\n\n  // STATES\n  // errorState\n  const [errorState, setErrorState] = useState();\n  const [errorText, setErrorText] = useState(''); // viewerState\n\n  const initialViewerState = {\n    controlsVisible: false,\n    filtersVisible: true,\n    activePlot: ''\n  };\n  const [viewerState, setViewerState] = useState(initialViewerState);\n  const [gridLayoutsState, setGridLayoutsState] = useState((_localStorage$getObje = localStorage.getObjectItem('grid.layouts')) !== null && _localStorage$getObje !== void 0 ? _localStorage$getObje : {});\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState, viewerState]); // gridLayoutsState\n\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState]); // gridItemsState\n\n  const [gridItemsState, setGridItemsState] = useState(((_localStorage$getObje2 = localStorage.getObjectItem('grid.items')) !== null && _localStorage$getObje2 !== void 0 ? _localStorage$getObje2 : []). // Workaround for bug in layout serialization - Infinity (and possibly others) gets saved as null\n  map(item => {\n    var _item$y;\n\n    return { ...item,\n      y: (_item$y = item.y) !== null && _item$y !== void 0 ? _item$y : Infinity\n    };\n  }));\n  useEffect(() => {\n    localStorage.setObjectItem('grid.items', gridItemsState);\n  }, [gridItemsState]); // gridResponsiveState\n\n  const initialResponsiveState = {\n    breakpoint: '',\n    cols: 12\n  };\n  const [gridResponsiveState, setGridResponsiveState] = useState(initialResponsiveState);\n  useEffect(() => {\n    forceResize();\n  }, [gridResponsiveState]); // filterState\n\n  const defaultFilterState = {\n    concept: defaultConcept,\n    constraints: []\n  };\n  const [filterState, setFilterState] = useState((_localStorage$getObje3 = localStorage.getObjectItem('filter')) !== null && _localStorage$getObje3 !== void 0 ? _localStorage$getObje3 : defaultFilterState);\n  useEffect(() => {\n    localStorage.setObjectItem('filter', filterState);\n  }, [filterState]); // subgroupsState\n\n  const [subgroupsState, setSubgroupsState] = useState((_localStorage$getObje4 = localStorage.getObjectItem('subgroups')) !== null && _localStorage$getObje4 !== void 0 ? _localStorage$getObje4 : []);\n  useEffect(() => {\n    localStorage.setObjectItem('subgroups', subgroupsState);\n  }, [subgroupsState]); // plotControlsState\n\n  const [plotControlsState, setPlotControlsState] = useState((_localStorage$getObje5 = localStorage.getObjectItem('controls')) !== null && _localStorage$getObje5 !== void 0 ? _localStorage$getObje5 : {});\n  useEffect(() => {\n    localStorage.setObjectItem('controls', plotControlsState);\n  }, [plotControlsState]); // plotsState\n\n  const [plotsState, setPlotsState] = useState((_localStorage$getObje6 = localStorage.getObjectItem('plots')) !== null && _localStorage$getObje6 !== void 0 ? _localStorage$getObje6 : {});\n  useEffect(() => {\n    localStorage.setObjectItem('plots', plotsState);\n  }, [plotsState]); // updatingState\n\n  const [updatingState, setUpdatingState] = useState({}); // HANDLERS\n\n  const onGridBreakpointChange = (breakpoint, cols) => {\n    setGridResponsiveState({\n      breakpoint: breakpoint,\n      cols: cols\n    });\n  };\n\n  const onViewerConfigurationToggle = () => {\n    setViewerState({ ...viewerState,\n      controlsVisible: !viewerState.controlsVisible\n    });\n  };\n\n  const onViewerFilterToggle = () => {\n    setViewerState({ ...viewerState,\n      filtersVisible: !viewerState.filtersVisible\n    });\n  };\n\n  const onGridLayoutChange = (layout, layouts) => {\n    setGridLayoutsState(layouts);\n  };\n\n  const onGridItemAdd = () => {\n    const identifier = utilities.generateIdentifier();\n    const newIdentifiers = [...Object.keys(plotsState), identifier];\n    backend.sessionInit(newIdentifiers).then(() => {\n      setGridItemsState([...gridItemsState, createGridItem(identifier)]);\n      setPlotControlsState({ ...plotControlsState,\n        ...{\n          [identifier]: createInitialPlotControlsState(identifier)\n        }\n      });\n      setPlotsState({ ...plotsState,\n        ...{\n          [identifier]: {\n            data: [],\n            layout: {}\n          }\n        }\n      });\n      setViewerState({ ...viewerState,\n        activePlot: identifier,\n        controlsVisible: true\n      });\n    }).catch(handleError);\n  };\n\n  const onGridItemRemove = identifier => {\n    const newPlotsState = { ...plotsState\n    };\n    delete newPlotsState[identifier];\n    backend.sessionInit(Object.keys(newPlotsState)).then(() => {\n      setGridItemsState(gridItemsState.filter(item => item.i !== identifier));\n      setPlotsState(newPlotsState);\n      const newPlotControlsState = { ...plotControlsState\n      };\n      delete newPlotControlsState[identifier];\n      setPlotControlsState(newPlotControlsState);\n\n      if (viewerState.activePlot === identifier) {\n        setViewerState({ ...viewerState,\n          activePlot: '',\n          controlsVisible: false\n        });\n      }\n    }).catch(handleError);\n  };\n\n  const onGridItemEdit = identifier => {\n    setViewerState({ ...viewerState,\n      activePlot: identifier,\n      controlsVisible: true\n    });\n  };\n\n  const onReset = () => {\n    backend.sessionReset().then(() => {\n      setViewerState(initialViewerState);\n      setGridResponsiveState(initialResponsiveState);\n      localStorage.setObjectItem('grid.layouts', {});\n      setGridLayoutsState({});\n      localStorage.setObjectItem('grid.items', []);\n      setGridItemsState([]);\n      localStorage.setObjectItem('filter', defaultFilterState);\n      setFilterState(defaultFilterState);\n      localStorage.setObjectItem('controls', {});\n      setPlotControlsState({});\n      localStorage.setObjectItem('plots', {});\n      setPlotsState({});\n    }).catch(handleError);\n  };\n\n  const onPlotSelected = (identifier, range, items) => {\n    if (!range) {\n      return;\n    }\n\n    setUpdating();\n    const newFilterState = { ...filterState,\n      constraints: [...filterState.constraints]\n    }; // Update/add x-constraint\n\n    if ([DiagramType.Scatter, DiagramType.Histogram, DiagramType.Timeline].includes(plotControlsState[identifier].controls.type)) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: range.x[0],\n        upper: range.x[1],\n        items: []\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(constraint => constraint.attribute === plotControlsState[identifier].controls.attX);\n\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    } // Update/add y-constraint\n\n\n    if ([DiagramType.Scatter, DiagramType.Timeline].includes(plotControlsState[identifier].controls.type)) {\n      const newYConstraint = {\n        attribute: plotControlsState[identifier].controls.attY,\n        lower: range.y[0],\n        upper: range.y[1],\n        items: []\n      };\n      const constraintYIndex = newFilterState.constraints.findIndex(constraint => constraint.attribute === plotControlsState[identifier].controls.attY);\n\n      if (constraintYIndex > -1) {\n        newFilterState.constraints[constraintYIndex] = newYConstraint;\n      } else {\n        newFilterState.constraints.push(newYConstraint);\n      }\n    } // Update/add discrete constraint\n\n\n    if ([DiagramType.Bar].includes(plotControlsState[identifier].controls.type)) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: null,\n        upper: null,\n        items: items\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(constraint => constraint.attribute === plotControlsState[identifier].controls.attX);\n\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    }\n\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend.filterUpdate(newFilterState).then(figures => {\n      handleFilterUpdateResponse(figures);\n    }).catch(handleError);\n  };\n\n  const onFilterChanged = filters => {\n    setUpdating();\n    const newFilterState = { ...filterState,\n      ...filters\n    };\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend.filterUpdate(newFilterState).then(figures => {\n      handleFilterUpdateResponse(figures);\n    }).catch(handleError);\n  };\n\n  const onSubgroupDefine = subgroup => {\n    backend.subgroupDefine(subgroup.name).then(() => {\n      setSubgroupsState([...subgroupsState.filter(_subgroup => _subgroup.name !== subgroup.name), subgroup]);\n      onFilterChanged({ ...filterState,\n        constraints: (subgroup === null || subgroup === void 0 ? void 0 : subgroup.constraints) || []\n      });\n    }).catch(handleError);\n  };\n\n  const onSubgroupDelete = name => {\n    //alert('Not yet implemented in backend.');\n    backend.subgroupDelete(name).then(response => {\n      setSubgroupsState([...subgroupsState.filter(subgroup => subgroup.name !== name)]);\n    });\n  };\n\n  const onSubgroupActivate = name => {\n    const subgroup = subgroupsState.find(subgroup => subgroup.name === name);\n    console.log(subgroup);\n    onFilterChanged({ ...filterState,\n      constraints: (subgroup === null || subgroup === void 0 ? void 0 : subgroup.constraints) || []\n    });\n  };\n\n  const onControlsChanged = (identifier, controls) => {\n    setUpdating(identifier);\n    const newControls = { ...plotControlsState[identifier].controls,\n      ...controls\n    };\n    const newPlotControls = { ...plotControlsState,\n      ...{\n        [identifier]: { ...plotsState[identifier],\n          controls: newControls\n        }\n      }\n    };\n    setPlotControlsState(newPlotControls);\n    utilities.devLog('new controls:', newControls);\n    backend.controlsUpdate(newPlotControls[identifier].controls).then(figure => {\n      handleControlsUpdateResponse(identifier, figure);\n    }).catch(handleError);\n  }; // HELPER (see first part above)\n\n\n  const handleError = error => {\n    console.log(error);\n\n    try {\n      setErrorText(`${error.toJSON().name}: ${error.toJSON().message}`);\n    } catch (e) {\n      setErrorText('ERROR: unknown');\n    }\n\n    setErrorState(true);\n  };\n\n  const handleControlsUpdateResponse = (identifier, figure) => {\n    setPlotsState({ ...plotsState,\n      [identifier]: { ...plotsState[identifier],\n        data: figure.data || [],\n        layout: figure.layout || {}\n      }\n    });\n    utilities.devLog(identifier, 'done');\n    setUpdatingState({ ...updatingState,\n      [identifier]: false\n    });\n  };\n\n  const handleFilterUpdateResponse = figures => {\n    const identifiers = Object.keys(figures);\n    const newPlotsState = { ...plotsState\n    };\n    const newUpdatingState = { ...updatingState\n    };\n    identifiers.forEach(identifier => {\n      newPlotsState[identifier] = {\n        data: figures[identifier].data || [],\n        layout: figures[identifier].layout || {}\n      };\n      newUpdatingState[identifier] = false;\n    });\n    setPlotsState(newPlotsState);\n    setUpdatingState(newUpdatingState);\n  };\n\n  const forceResize = () => {\n    // Workaround to trigger plot resize\n    window.dispatchEvent(new Event('resize'));\n  };\n\n  const createGridItem = identifier => {\n    return {\n      i: identifier,\n      x: gridItemsState.length * 5 % gridResponsiveState.cols,\n      y: Infinity,\n      w: 5,\n      h: 4\n    };\n  };\n\n  const createInitialPlotControlsState = identifier => {\n    return {\n      controls: { ...initialControls,\n        identifier\n      }\n    };\n  };\n\n  const setUpdating = identifier => {\n    if (identifier) {\n      setUpdatingState({ ...updatingState,\n        [identifier]: true\n      });\n    } else {\n      const newState = {};\n      Object.keys(plotControlsState).forEach(identifier => {\n        newState[identifier] = true;\n      });\n      setUpdatingState(newState);\n    }\n  }; // RENDER\n\n\n  const createGridItemElement = item => {\n    var _plotsState$item$i, _plotsState$item$i2;\n\n    return /*#__PURE__*/React.createElement(Card, {\n      key: item.i,\n      \"data-grid\": item,\n      className: `grid__item ${viewerState.activePlot === item.i ? ' grid__item--active' : ''}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 537,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"grid__item-header grid--draggable\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 544,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(IconButton, {\n      size: \"small\",\n      \"aria-label\": \"edit\",\n      onClick: () => {\n        onGridItemEdit(item.i);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 545,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(EditIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 552,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(IconButton, {\n      size: \"small\",\n      \"aria-label\": \"close\",\n      onClick: () => {\n        onGridItemRemove(item.i);\n      },\n      className: \"grid__item--close\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 554,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(CloseIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 562,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"grid__item-loader\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 565,\n        columnNumber: 9\n      }\n    }, updatingState[item.i] && /*#__PURE__*/React.createElement(LinearProgress, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 566,\n        columnNumber: 37\n      }\n    })), /*#__PURE__*/React.createElement(CardContent, {\n      className: \"grid__item-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 568,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Plot, {\n      identifier: item.i,\n      data: (_plotsState$item$i = plotsState[item.i]) === null || _plotsState$item$i === void 0 ? void 0 : _plotsState$item$i.data,\n      layout: (_plotsState$item$i2 = plotsState[item.i]) === null || _plotsState$item$i2 === void 0 ? void 0 : _plotsState$item$i2.layout,\n      onSelected: onPlotSelected,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 569,\n        columnNumber: 11\n      }\n    })));\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 581,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"toolbar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 582,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"toolbar__left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 583,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onGridItemAdd,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(AddIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 588,\n        columnNumber: 24\n      }\n    }),\n    title: \"Add new diagram\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 584,\n      columnNumber: 11\n    }\n  }, \"Add\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: forceResize,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(AspectRatioIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 598,\n        columnNumber: 24\n      }\n    }),\n    title: \"Force resize\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 594,\n      columnNumber: 11\n    }\n  }, \"Resize\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: onReset,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(ReplayIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 608,\n        columnNumber: 24\n      }\n    }),\n    title: \"Reset session\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 604,\n      columnNumber: 11\n    }\n  }, \"Reset session\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"toolbar__right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 615,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onViewerConfigurationToggle,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(SettingsIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 620,\n        columnNumber: 24\n      }\n    }),\n    title: \"Toggle configuration panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 616,\n      columnNumber: 11\n    }\n  }, \"Configuration\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: onViewerFilterToggle,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(FilterListIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 630,\n        columnNumber: 24\n      }\n    }),\n    title: \"Toggle filter panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 626,\n      columnNumber: 11\n    }\n  }, \"Filter\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 637,\n      columnNumber: 7\n    }\n  }, viewerState.filtersVisible && /*#__PURE__*/React.createElement(Filter, {\n    filter: filterState,\n    subgroups: subgroupsState,\n    onFilterChanged: onFilterChanged,\n    onSubgroupDefine: onSubgroupDefine,\n    onSubgroupDelete: onSubgroupDelete,\n    onSubgroupActivate: onSubgroupActivate,\n    onClose: onViewerFilterToggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 639,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    breakpointCols: {\n      lg: 12,\n      md: 10,\n      sm: 6,\n      xs: 4,\n      xxs: 2\n    },\n    rowHeight: 100,\n    layouts: gridLayoutsState,\n    onBreakpointChange: onGridBreakpointChange,\n    onLayoutChange: onGridLayoutChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 649,\n      columnNumber: 9\n    }\n  }, gridItemsState.map(item => createGridItemElement(item))), viewerState.controlsVisible && /*#__PURE__*/React.createElement(Configuration, {\n    controls: (_plotControlsState$vi = plotControlsState[viewerState.activePlot]) === null || _plotControlsState$vi === void 0 ? void 0 : _plotControlsState$vi.controls,\n    onControlsChanged: onControlsChanged,\n    onClose: onViewerConfigurationToggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 661,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Snackbar, {\n    open: errorState,\n    autoHideDuration: 10000,\n    onClose: () => {\n      setErrorState(false);\n    },\n    anchorOrigin: {\n      vertical: 'top',\n      horizontal: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 669,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    variant: \"filled\",\n    severity: \"error\",\n    onClose: () => {\n      setErrorState(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 677,\n      columnNumber: 9\n    }\n  }, errorText)));\n};\n\nexport default Viewer;","map":{"version":3,"sources":["/Users/philippwegner/Desktop/UKB/git/PostIDSN-Viewer/src/containers/Viewer.tsx"],"names":["React","useState","useEffect","Grid","Plot","localStorage","backend","Fit","Legend","utilities","Filter","defaultConcept","Configuration","DiagramType","initialDiagramType","Visit","Button","Card","CardContent","IconButton","LinearProgress","AddIcon","AspectRatioIcon","ReplayIcon","SettingsIcon","FilterListIcon","EditIcon","CloseIcon","Alert","Snackbar","initialControls","identifier","type","attX","attY","attC","dt","visit","all","followup","tolerance","norm","stack","fit","none","legend","bins","Viewer","props","errorState","setErrorState","errorText","setErrorText","initialViewerState","controlsVisible","filtersVisible","activePlot","viewerState","setViewerState","gridLayoutsState","setGridLayoutsState","getObjectItem","setObjectItem","forceResize","gridItemsState","setGridItemsState","map","item","y","Infinity","initialResponsiveState","breakpoint","cols","gridResponsiveState","setGridResponsiveState","defaultFilterState","concept","constraints","filterState","setFilterState","subgroupsState","setSubgroupsState","plotControlsState","setPlotControlsState","plotsState","setPlotsState","updatingState","setUpdatingState","onGridBreakpointChange","onViewerConfigurationToggle","onViewerFilterToggle","onGridLayoutChange","layout","layouts","onGridItemAdd","generateIdentifier","newIdentifiers","Object","keys","sessionInit","then","createGridItem","createInitialPlotControlsState","data","catch","handleError","onGridItemRemove","newPlotsState","filter","i","newPlotControlsState","onGridItemEdit","onReset","sessionReset","onPlotSelected","range","items","setUpdating","newFilterState","Scatter","Histogram","Timeline","includes","controls","newXConstraint","attribute","lower","x","upper","constraintXIndex","findIndex","constraint","push","newYConstraint","constraintYIndex","Bar","devLog","filterUpdate","figures","handleFilterUpdateResponse","onFilterChanged","filters","onSubgroupDefine","subgroup","subgroupDefine","name","_subgroup","onSubgroupDelete","subgroupDelete","response","onSubgroupActivate","find","console","log","onControlsChanged","newControls","newPlotControls","controlsUpdate","figure","handleControlsUpdateResponse","error","toJSON","message","e","identifiers","newUpdatingState","forEach","window","dispatchEvent","Event","length","w","h","newState","createGridItemElement","lg","md","sm","xs","xxs","vertical","horizontal"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Grid from '../components/Grid';\nimport Plot from '../components/Plot';\nimport localStorage from '../services/LocalStorage';\nimport backend, { Fit, Legend } from '../services/Backend';\nimport utilities from '../services/Utilities';\nimport Filter, { FilterState, defaultConcept, Subgroup } from './Filter';\nimport Configuration, {\n  ControlsState,\n  DiagramType,\n  initialDiagramType,\n  Visit,\n} from './Controls';\nimport { Figure } from 'react-plotly.js';\nimport { Datum } from 'plotly.js';\nimport Button from '@material-ui/core/Button';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport IconButton from '@material-ui/core/IconButton';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport './Viewer.css';\nimport AddIcon from '@material-ui/icons/Add';\nimport AspectRatioIcon from '@material-ui/icons/AspectRatio';\nimport ReplayIcon from '@material-ui/icons/Replay';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport EditIcon from '@material-ui/icons/Edit';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Alert from '@material-ui/lab/Alert';\nimport Snackbar from '@material-ui/core/Snackbar';\n\n\n// CONFIG\n\nexport const initialControls = {\n  identifier: '',\n  type: initialDiagramType,\n  attX: '',\n  attY: '',\n  attC: '',\n  dt: 0,\n  visit: Visit.all,\n  followup: 0,\n  tolerance: 0,\n  norm: false,\n  stack: false,\n  fit: Fit.none,\n  legend: Legend.legend,\n  bins: 0,\n};\n\n// PROPS\n\ninterface Props {}\n\nconst Viewer: React.FunctionComponent<Props> = props => {\n  // STATES\n\n  // errorState\n  const [errorState, setErrorState] = useState<boolean>();\n  const [errorText, setErrorText] = useState<string>('');\n\n  // viewerState\n  const initialViewerState = {\n    controlsVisible: false,\n    filtersVisible: true,\n    activePlot: '',\n  };\n  const [viewerState, setViewerState] =\n    useState<{\n      controlsVisible: boolean;\n      filtersVisible: boolean;\n      activePlot: string;\n    }>(initialViewerState);\n  const [gridLayoutsState, setGridLayoutsState] =\n    useState<ReactGridLayout.Layouts>(\n      localStorage.getObjectItem('grid.layouts') ?? {},\n    );\n\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState, viewerState]);\n\n  // gridLayoutsState\n\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState]);\n\n  // gridItemsState\n  const [gridItemsState, setGridItemsState] = useState<\n    ReactGridLayout.Layout[]\n  >(\n    (localStorage.getObjectItem('grid.items') ?? [])\n      // Workaround for bug in layout serialization - Infinity (and possibly others) gets saved as null\n      .map((item: ReactGridLayout.Layout) => {\n        return { ...item, y: item.y ?? Infinity };\n      }),\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('grid.items', gridItemsState);\n  }, [gridItemsState]);\n\n  // gridResponsiveState\n  const initialResponsiveState = { breakpoint: '', cols: 12 };\n  const [gridResponsiveState, setGridResponsiveState] = useState<{\n    breakpoint: string;\n    cols: number;\n  }>(initialResponsiveState);\n  useEffect(() => {\n    forceResize();\n  }, [gridResponsiveState]);\n\n  // filterState\n  const defaultFilterState: FilterState = {\n    concept: defaultConcept,\n    constraints: [],\n  };\n\n  const [filterState, setFilterState] = useState<FilterState>(\n    localStorage.getObjectItem('filter') ?? defaultFilterState,\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('filter', filterState);\n  }, [filterState]);\n\n  // subgroupsState\n  const [subgroupsState, setSubgroupsState] = useState<Subgroup[]>(\n    localStorage.getObjectItem('subgroups') ?? [],\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('subgroups', subgroupsState);\n  }, [subgroupsState]);\n\n  // plotControlsState\n  interface PlotControlsState {\n    [key: string]: { controls: ControlsState };\n  }\n\n  const [plotControlsState, setPlotControlsState] = useState<PlotControlsState>(\n    localStorage.getObjectItem('controls') ?? {},\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('controls', plotControlsState);\n  }, [plotControlsState]);\n\n  // plotsState\n  interface PlotState {\n    data: Plotly.Data[];\n    layout: Partial<Plotly.Layout>;\n  }\n  const [plotsState, setPlotsState] = useState<{ [key: string]: PlotState }>(\n    localStorage.getObjectItem('plots') ?? {},\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('plots', plotsState);\n  }, [plotsState]);\n\n  // updatingState\n  interface UpdatingState {\n    [key: string]: boolean;\n  }\n  const [updatingState, setUpdatingState] = useState<UpdatingState>({});\n\n  // HANDLERS\n\n  const onGridBreakpointChange = (breakpoint: string, cols: number) => {\n    setGridResponsiveState({\n      breakpoint: breakpoint,\n      cols: cols,\n    });\n  };\n\n  const onViewerConfigurationToggle = () => {\n    setViewerState({\n      ...viewerState,\n      controlsVisible: !viewerState.controlsVisible,\n    });\n  };\n\n  const onViewerFilterToggle = () => {\n    setViewerState({\n      ...viewerState,\n      filtersVisible: !viewerState.filtersVisible,\n    });\n  };\n\n  const onGridLayoutChange = (\n    layout: ReactGridLayout.Layout[],\n    layouts: ReactGridLayout.Layouts,\n  ) => {\n    setGridLayoutsState(layouts);\n  };\n\n  const onGridItemAdd = () => {\n    const identifier = utilities.generateIdentifier();\n    const newIdentifiers = [...Object.keys(plotsState), identifier];\n    backend\n      .sessionInit(newIdentifiers)\n      .then(() => {\n        setGridItemsState([...gridItemsState, createGridItem(identifier)]);\n        setPlotControlsState({\n          ...plotControlsState,\n          ...{ [identifier]: createInitialPlotControlsState(identifier) },\n        });\n        setPlotsState({\n          ...plotsState,\n          ...{ [identifier]: { data: [], layout: {} } },\n        });\n        setViewerState({\n          ...viewerState,\n          activePlot: identifier,\n          controlsVisible: true,\n        });\n      })\n      .catch(handleError);\n  };\n\n  const onGridItemRemove = (identifier: string) => {\n    const newPlotsState = { ...plotsState };\n    delete newPlotsState[identifier];\n    backend\n      .sessionInit(Object.keys(newPlotsState))\n      .then(() => {\n        setGridItemsState(\n          gridItemsState.filter(\n            (item: ReactGridLayout.Layout) => item.i !== identifier,\n          ),\n        );\n        setPlotsState(newPlotsState);\n        const newPlotControlsState = { ...plotControlsState };\n        delete newPlotControlsState[identifier];\n        setPlotControlsState(newPlotControlsState);\n        if (viewerState.activePlot === identifier) {\n          setViewerState({\n            ...viewerState,\n            activePlot: '',\n            controlsVisible: false,\n          });\n        }\n      })\n      .catch(handleError);\n  };\n\n  const onGridItemEdit = (identifier: string) => {\n    setViewerState({\n      ...viewerState,\n      activePlot: identifier,\n      controlsVisible: true,\n    });\n  };\n\n  const onReset = () => {\n    backend\n      .sessionReset()\n      .then(() => {\n        setViewerState(initialViewerState);\n        setGridResponsiveState(initialResponsiveState);\n        localStorage.setObjectItem('grid.layouts', {});\n        setGridLayoutsState({});\n        localStorage.setObjectItem('grid.items', []);\n        setGridItemsState([]);\n        localStorage.setObjectItem('filter', defaultFilterState);\n        setFilterState(defaultFilterState);\n        localStorage.setObjectItem('controls', {});\n        setPlotControlsState({});\n        localStorage.setObjectItem('plots', {});\n        setPlotsState({});\n      })\n      .catch(handleError);\n  };\n\n  const onPlotSelected = (\n    identifier: string,\n    range: Plotly.SelectionRange | undefined,\n    items: Datum[],\n  ) => {\n    if (!range) {\n      return;\n    }\n\n    setUpdating();\n    const newFilterState: FilterState = {\n      ...filterState,\n      constraints: [...filterState.constraints],\n    };\n    // Update/add x-constraint\n    if (\n      [\n        DiagramType.Scatter,\n        DiagramType.Histogram,\n        DiagramType.Timeline,\n      ].includes(plotControlsState[identifier].controls.type)\n    ) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: range.x[0],\n        upper: range.x[1],\n        items: [],\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(\n        constraint =>\n          constraint.attribute === plotControlsState[identifier].controls.attX,\n      );\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    }\n    // Update/add y-constraint\n    if (\n      [DiagramType.Scatter, DiagramType.Timeline].includes(\n        plotControlsState[identifier].controls.type,\n      )\n    ) {\n      const newYConstraint = {\n        attribute: plotControlsState[identifier].controls.attY,\n        lower: range.y[0],\n        upper: range.y[1],\n        items: [],\n      };\n      const constraintYIndex = newFilterState.constraints.findIndex(\n        constraint =>\n          constraint.attribute === plotControlsState[identifier].controls.attY,\n      );\n      if (constraintYIndex > -1) {\n        newFilterState.constraints[constraintYIndex] = newYConstraint;\n      } else {\n        newFilterState.constraints.push(newYConstraint);\n      }\n    }\n    // Update/add discrete constraint\n    if (\n      [DiagramType.Bar].includes(plotControlsState[identifier].controls.type)\n    ) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: null,\n        upper: null,\n        items: items,\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(\n        constraint =>\n          constraint.attribute === plotControlsState[identifier].controls.attX,\n      );\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    }\n\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend\n      .filterUpdate(newFilterState)\n      .then((figures: { [key: string]: Partial<Figure> }) => {\n        handleFilterUpdateResponse(figures);\n      })\n      .catch(handleError);\n  };\n\n  const onFilterChanged = (filters: Partial<FilterState>) => {\n    setUpdating();\n    const newFilterState: FilterState = {\n      ...filterState,\n      ...filters,\n    };\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend\n      .filterUpdate(newFilterState)\n      .then((figures: { [key: string]: Partial<Figure> }) => {\n        handleFilterUpdateResponse(figures);\n      })\n      .catch(handleError);\n  };\n\n  const onSubgroupDefine = (subgroup: Subgroup) => {\n    backend\n      .subgroupDefine(subgroup.name)\n      .then(() => {\n        setSubgroupsState([\n          ...subgroupsState.filter(\n            _subgroup => _subgroup.name !== subgroup.name,\n          ),\n          subgroup,\n        ]);\n        onFilterChanged({\n          ...filterState,\n          constraints: subgroup?.constraints || [],\n        });\n        \n\n      })\n      .catch(handleError);\n  };\n\n  const onSubgroupDelete = (name: string) => {\n    //alert('Not yet implemented in backend.');\n    backend.subgroupDelete(name).then(response =>{\n      setSubgroupsState([\n        ...subgroupsState.filter(subgroup => subgroup.name !== name),\n      ]);\n    });\n    \n  };\n  const onSubgroupActivate = (name: string) => {\n    const subgroup = subgroupsState.find(subgroup => subgroup.name === name);\n    console.log(subgroup);\n    onFilterChanged({\n      ...filterState,\n      constraints: subgroup?.constraints || [],\n    });\n  };\n\n  const onControlsChanged = (\n    identifier: string,\n    controls: Partial<ControlsState>,\n  ) => {\n    setUpdating(identifier);\n    const newControls: ControlsState = {\n      ...plotControlsState[identifier].controls,\n      ...controls,\n    };\n    const newPlotControls = {\n      ...plotControlsState,\n      ...{\n        [identifier]: {\n          ...plotsState[identifier],\n          controls: newControls,\n        },\n      },\n    };\n    setPlotControlsState(newPlotControls);\n    utilities.devLog('new controls:', newControls);\n    backend\n      .controlsUpdate(newPlotControls[identifier].controls)\n      .then((figure: Partial<Figure>) => {\n        handleControlsUpdateResponse(identifier, figure);\n      })\n      .catch(handleError);\n  };\n\n  // HELPER (see first part above)\n\n  const handleError = (error: any) => {\n    console.log(error);\n    try {\n      setErrorText(`${error.toJSON().name}: ${error.toJSON().message}`);\n    } catch (e) {\n      setErrorText('ERROR: unknown');\n    }\n\n    setErrorState(true);\n  };\n\n  const handleControlsUpdateResponse = (\n    identifier: string,\n    figure: Partial<Figure>,\n  ) => {\n    setPlotsState({\n      ...plotsState,\n      [identifier]: {\n        ...plotsState[identifier],\n        data: figure.data || [],\n        layout: figure.layout || {},\n      },\n    });\n    utilities.devLog(identifier, 'done');\n    setUpdatingState({\n      ...updatingState,\n      [identifier]: false,\n    });\n  };\n\n  const handleFilterUpdateResponse = (figures: {\n    [key: string]: Partial<Figure>;\n  }) => {\n    const identifiers = Object.keys(figures);\n    const newPlotsState = { ...plotsState };\n    const newUpdatingState = { ...updatingState };\n    identifiers.forEach(identifier => {\n      newPlotsState[identifier] = {\n        data: figures[identifier].data || [],\n        layout: figures[identifier].layout || {},\n      };\n      newUpdatingState[identifier] = false;\n    });\n    setPlotsState(newPlotsState);\n    setUpdatingState(newUpdatingState);\n  };\n\n  const forceResize = () => {\n    // Workaround to trigger plot resize\n    window.dispatchEvent(new Event('resize'));\n  };\n\n  const createGridItem = (identifier: string): ReactGridLayout.Layout => {\n    return {\n      i: identifier,\n      x: (gridItemsState.length * 5) % gridResponsiveState.cols,\n      y: Infinity,\n      w: 5,\n      h: 4,\n    };\n  };\n\n  const createInitialPlotControlsState = (\n    identifier: string,\n  ): { controls: ControlsState } => {\n    return { controls: { ...initialControls, identifier } };\n  };\n\n  const setUpdating = (identifier?: string) => {\n    if (identifier) {\n      setUpdatingState({\n        ...updatingState,\n        [identifier]: true,\n      });\n    } else {\n      const newState: UpdatingState = {};\n      Object.keys(plotControlsState).forEach(identifier => {\n        newState[identifier] = true;\n      });\n      setUpdatingState(newState);\n    }\n  };\n\n  // RENDER\n\n  const createGridItemElement = (item: ReactGridLayout.Layout) => {\n    return (\n      <Card\n        key={item.i}\n        data-grid={item}\n        className={`grid__item ${\n          viewerState.activePlot === item.i ? ' grid__item--active' : ''\n        }`}\n      >\n        <div className=\"grid__item-header grid--draggable\">\n          <IconButton\n            size=\"small\"\n            aria-label=\"edit\"\n            onClick={() => {\n              onGridItemEdit(item.i);\n            }}\n          >\n            <EditIcon />\n          </IconButton>\n          <IconButton\n            size=\"small\"\n            aria-label=\"close\"\n            onClick={() => {\n              onGridItemRemove(item.i);\n            }}\n            className=\"grid__item--close\"\n          >\n            <CloseIcon />\n          </IconButton>\n        </div>\n        <div className=\"grid__item-loader\">\n          {updatingState[item.i] && <LinearProgress />}\n        </div>\n        <CardContent className=\"grid__item-content\">\n          <Plot\n            identifier={item.i}\n            data={plotsState[item.i]?.data}\n            layout={plotsState[item.i]?.layout}\n            onSelected={onPlotSelected}\n          />\n        </CardContent>\n      </Card>\n    );\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"toolbar\">\n        <div className=\"toolbar__left\">\n          <Button\n            onClick={onGridItemAdd}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<AddIcon />}\n            title=\"Add new diagram\"\n          >\n            Add\n          </Button>\n\n          <Button\n            onClick={forceResize}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<AspectRatioIcon />}\n            title=\"Force resize\"\n          >\n            Resize\n          </Button>\n\n          <Button\n            onClick={onReset}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<ReplayIcon />}\n            title=\"Reset session\"\n          >\n            Reset session\n          </Button>\n        </div>\n\n        <div className=\"toolbar__right\">\n          <Button\n            onClick={onViewerConfigurationToggle}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<SettingsIcon />}\n            title=\"Toggle configuration panel\"\n          >\n            Configuration\n          </Button>\n\n          <Button\n            onClick={onViewerFilterToggle}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<FilterListIcon />}\n            title=\"Toggle filter panel\"\n          >\n            Filter\n          </Button>\n        </div>\n      </div>\n      <div className=\"row\">\n        {viewerState.filtersVisible && (\n          <Filter\n            filter={filterState}\n            subgroups={subgroupsState}\n            onFilterChanged={onFilterChanged}\n            onSubgroupDefine={onSubgroupDefine}\n            onSubgroupDelete={onSubgroupDelete}\n            onSubgroupActivate={onSubgroupActivate}\n            onClose={onViewerFilterToggle}\n          />\n        )}\n        <Grid\n          breakpointCols={{ lg: 12, md: 10, sm: 6, xs: 4, xxs: 2 }}\n          rowHeight={100}\n          layouts={gridLayoutsState}\n          onBreakpointChange={onGridBreakpointChange}\n          onLayoutChange={onGridLayoutChange}\n        >\n          {gridItemsState.map((item: ReactGridLayout.Layout) =>\n            createGridItemElement(item),\n          )}\n        </Grid>\n        {viewerState.controlsVisible && (\n          <Configuration\n            controls={plotControlsState[viewerState.activePlot]?.controls}\n            onControlsChanged={onControlsChanged}\n            onClose={onViewerConfigurationToggle}\n          />\n        )}\n      </div>\n\n      <Snackbar\n        open={errorState}\n        autoHideDuration={10000}\n        onClose={() => {\n          setErrorState(false);\n        }}\n        anchorOrigin={{ vertical: 'top', horizontal: 'right' }}\n      >\n        <Alert\n          variant=\"filled\"\n          severity=\"error\"\n          onClose={() => {\n            setErrorState(false);\n          }}\n        >\n          {errorText}\n        </Alert>\n      </Snackbar>\n    </div>\n  );\n};\n\nexport default Viewer;\n"]},"metadata":{},"sourceType":"module"}