{"ast":null,"code":"var _jsxFileName = \"/Users/philippwegner/Desktop/UKB/git/PostIDSN-Viewer/src/containers/Viewer.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport Grid from '../components/Grid';\nimport Plot from '../components/Plot';\nimport localStorage from '../services/LocalStorage';\nimport backend, { Fit, Legend } from '../services/Backend';\nimport utilities from '../services/Utilities';\nimport Filter, { defaultConcept } from './Filter';\nimport Configuration, { DiagramType, initialDiagramType, Visit } from './Controls';\nimport Button from '@material-ui/core/Button';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport IconButton from '@material-ui/core/IconButton';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport './Viewer.css';\nimport AddIcon from '@material-ui/icons/Add';\nimport AspectRatioIcon from '@material-ui/icons/AspectRatio';\nimport ReplayIcon from '@material-ui/icons/Replay';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport EditIcon from '@material-ui/icons/Edit';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Alert from '@material-ui/lab/Alert';\nimport Snackbar from '@material-ui/core/Snackbar'; // CONFIG\n\nexport const initialControls = {\n  identifier: '',\n  type: initialDiagramType,\n  attX: '',\n  attY: '',\n  attC: '',\n  dt: 0,\n  visit: Visit.all,\n  followup: 0,\n  tolerance: 0,\n  norm: false,\n  stack: false,\n  fit: Fit.none,\n  legend: Legend.legend,\n  bins: 0\n}; // PROPS\n\nconst Viewer = props => {\n  var _localStorage$getObje, _localStorage$getObje2, _localStorage$getObje3, _localStorage$getObje4, _localStorage$getObje5, _localStorage$getObje6, _plotControlsState$vi;\n\n  // GET ATTRIBUTES METHODS\n  let Datatype;\n\n  (function (Datatype) {\n    Datatype[\"date\"] = \"date\";\n    Datatype[\"int\"] = \"int\";\n    Datatype[\"float\"] = \"float\";\n    Datatype[\"code\"] = \"code\";\n    Datatype[\"subgroups\"] = \"SUBGROUPS\";\n    Datatype[\"patients\"] = \"PATIENTS\";\n  })(Datatype || (Datatype = {}));\n\n  const [attributes, setAttributes] = useState([]); // PATIENTS and SUBGROUPS are added to attributes manually and have this values as datatype\n\n  const getTooltip = attribute_ => {\n    attributes.forEach(attr => {\n      console.log(attr);\n    });\n    return attributes ? attributes.find(attr => attr.attribute === attribute_)[\"attributeTooltip\"] : \"\";\n  };\n\n  const filter = datatypes => {\n    return attributes.filter(attribute => Object.values(datatypes).findIndex(datatype => attribute.datatype === datatype) !== -1);\n  }; // STATES\n  // errorState\n\n\n  const [errorState, setErrorState] = useState();\n  const [errorText, setErrorText] = useState(''); //\n\n  const [loadingAttributes, setLoadeingAttributes] = useState();\n  useEffect(() => {\n    backend.getAttributes().then(response => {\n      setAttributes(response.allAttributes);\n    });\n  }, []); // viewerState\n\n  const initialViewerState = {\n    controlsVisible: false,\n    filtersVisible: true,\n    activePlot: ''\n  };\n  const [viewerState, setViewerState] = useState(initialViewerState);\n  const [gridLayoutsState, setGridLayoutsState] = useState((_localStorage$getObje = localStorage.getObjectItem('grid.layouts')) !== null && _localStorage$getObje !== void 0 ? _localStorage$getObje : {});\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState, viewerState]); // gridLayoutsState\n\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState]); // gridItemsState\n\n  const [gridItemsState, setGridItemsState] = useState(((_localStorage$getObje2 = localStorage.getObjectItem('grid.items')) !== null && _localStorage$getObje2 !== void 0 ? _localStorage$getObje2 : []). // Workaround for bug in layout serialization - Infinity (and possibly others) gets saved as null\n  map(item => {\n    var _item$y;\n\n    return { ...item,\n      y: (_item$y = item.y) !== null && _item$y !== void 0 ? _item$y : Infinity\n    };\n  }));\n  useEffect(() => {\n    localStorage.setObjectItem('grid.items', gridItemsState);\n  }, [gridItemsState]); // gridResponsiveState\n\n  const initialResponsiveState = {\n    breakpoint: '',\n    cols: 12\n  };\n  const [gridResponsiveState, setGridResponsiveState] = useState(initialResponsiveState);\n  useEffect(() => {\n    forceResize();\n  }, [gridResponsiveState]); // filterState\n\n  const defaultFilterState = {\n    concept: defaultConcept,\n    constraints: []\n  };\n  const [filterState, setFilterState] = useState((_localStorage$getObje3 = localStorage.getObjectItem('filter')) !== null && _localStorage$getObje3 !== void 0 ? _localStorage$getObje3 : defaultFilterState);\n  useEffect(() => {\n    localStorage.setObjectItem('filter', filterState);\n  }, [filterState]); // subgroupsState\n\n  const [subgroupsState, setSubgroupsState] = useState((_localStorage$getObje4 = localStorage.getObjectItem('subgroups')) !== null && _localStorage$getObje4 !== void 0 ? _localStorage$getObje4 : []);\n  useEffect(() => {\n    localStorage.setObjectItem('subgroups', subgroupsState);\n  }, [subgroupsState]); // plotControlsState\n\n  const [plotControlsState, setPlotControlsState] = useState((_localStorage$getObje5 = localStorage.getObjectItem('controls')) !== null && _localStorage$getObje5 !== void 0 ? _localStorage$getObje5 : {});\n  useEffect(() => {\n    localStorage.setObjectItem('controls', plotControlsState);\n  }, [plotControlsState]); // plotsState\n\n  const [plotsState, setPlotsState] = useState((_localStorage$getObje6 = localStorage.getObjectItem('plots')) !== null && _localStorage$getObje6 !== void 0 ? _localStorage$getObje6 : {});\n  useEffect(() => {\n    localStorage.setObjectItem('plots', plotsState);\n  }, [plotsState]); // updatingState\n\n  const [updatingState, setUpdatingState] = useState({}); // HANDLERS\n\n  const onGridBreakpointChange = (breakpoint, cols) => {\n    setGridResponsiveState({\n      breakpoint: breakpoint,\n      cols: cols\n    });\n  };\n\n  const onViewerConfigurationToggle = () => {\n    setViewerState({ ...viewerState,\n      controlsVisible: !viewerState.controlsVisible\n    });\n  };\n\n  const onViewerFilterToggle = () => {\n    setViewerState({ ...viewerState,\n      filtersVisible: !viewerState.filtersVisible\n    });\n  };\n\n  const onGridLayoutChange = (layout, layouts) => {\n    setGridLayoutsState(layouts);\n  };\n\n  const onGridItemAdd = () => {\n    const identifier = utilities.generateIdentifier();\n    const newIdentifiers = [...Object.keys(plotsState), identifier];\n    backend.sessionInit(newIdentifiers).then(() => {\n      var _document$querySelect, _document$querySelect2;\n\n      setGridItemsState([...gridItemsState, createGridItem(identifier)]);\n      setPlotControlsState({ ...plotControlsState,\n        ...{\n          [identifier]: createInitialPlotControlsState(identifier)\n        }\n      });\n      setPlotsState({ ...plotsState,\n        ...{\n          [identifier]: {\n            data: [],\n            layout: {}\n          }\n        }\n      });\n      setViewerState({ ...viewerState,\n        activePlot: identifier,\n        controlsVisible: true\n      });\n      (_document$querySelect = document.querySelector(\".scrollContainer\")) === null || _document$querySelect === void 0 ? void 0 : _document$querySelect.scrollTo({\n        top: (_document$querySelect2 = document.querySelector(\".scrollContainer\")) === null || _document$querySelect2 === void 0 ? void 0 : _document$querySelect2.scrollHeight,\n        behavior: 'smooth'\n      });\n    }).catch(handleError);\n  };\n\n  const onGridItemRemove = identifier => {\n    const newPlotsState = { ...plotsState\n    };\n    delete newPlotsState[identifier];\n    backend.sessionInit(Object.keys(newPlotsState)).then(() => {\n      setGridItemsState(gridItemsState.filter(item => item.i !== identifier));\n      setPlotsState(newPlotsState);\n      const newPlotControlsState = { ...plotControlsState\n      };\n      delete newPlotControlsState[identifier];\n      setPlotControlsState(newPlotControlsState);\n\n      if (viewerState.activePlot === identifier) {\n        setViewerState({ ...viewerState,\n          activePlot: '',\n          controlsVisible: false\n        });\n      }\n    }).catch(handleError);\n  };\n\n  const onGridItemEdit = identifier => {\n    setViewerState({ ...viewerState,\n      activePlot: identifier,\n      controlsVisible: true\n    });\n  };\n\n  const onReset = () => {\n    backend.sessionReset().then(() => {\n      setViewerState(initialViewerState);\n      setGridResponsiveState(initialResponsiveState);\n      localStorage.setObjectItem('grid.layouts', {});\n      setGridLayoutsState({});\n      localStorage.setObjectItem('grid.items', []);\n      setGridItemsState([]);\n      localStorage.setObjectItem('filter', defaultFilterState);\n      setFilterState(defaultFilterState);\n      localStorage.setObjectItem('controls', {});\n      setPlotControlsState({});\n      localStorage.setObjectItem('plots', {});\n      setPlotsState({});\n      localStorage.setObjectItem('subgroups', []);\n      setSubgroupsState([]);\n    }).catch(handleError);\n  };\n\n  const onPlotSelected = (identifier, range, items) => {\n    if (!range) {\n      return;\n    }\n\n    setUpdating();\n    const newFilterState = { ...filterState,\n      constraints: [...filterState.constraints]\n    }; // Update/add x-constraint\n\n    if ([DiagramType.Scatter, DiagramType.Histogram, DiagramType.Timeline].includes(plotControlsState[identifier].controls.type)) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: range.x[0],\n        upper: range.x[1],\n        items: []\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(constraint => constraint.attribute === plotControlsState[identifier].controls.attX);\n\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    } // Update/add y-constraint\n\n\n    if ([DiagramType.Scatter, DiagramType.Timeline].includes(plotControlsState[identifier].controls.type)) {\n      const newYConstraint = {\n        attribute: plotControlsState[identifier].controls.attY,\n        lower: range.y[0],\n        upper: range.y[1],\n        items: []\n      };\n      const constraintYIndex = newFilterState.constraints.findIndex(constraint => constraint.attribute === plotControlsState[identifier].controls.attY);\n\n      if (constraintYIndex > -1) {\n        newFilterState.constraints[constraintYIndex] = newYConstraint;\n      } else {\n        newFilterState.constraints.push(newYConstraint);\n      }\n    } // Update/add discrete constraint\n\n\n    if ([DiagramType.Bar].includes(plotControlsState[identifier].controls.type)) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: null,\n        upper: null,\n        items: items\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(constraint => constraint.attribute === plotControlsState[identifier].controls.attX);\n\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    }\n\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend.filterUpdate(newFilterState).then(figures => {\n      handleFilterUpdateResponse(figures);\n    }).catch(handleError);\n  };\n\n  const onFilterChanged = filters => {\n    setUpdating();\n    const newFilterState = { ...filterState,\n      ...filters\n    };\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend.filterUpdate(newFilterState).then(figures => {\n      handleFilterUpdateResponse(figures);\n    }).catch(handleError);\n  };\n\n  const onSubgroupDefine = subgroup => {\n    backend.subgroupDefine(subgroup.name).then(() => {\n      setSubgroupsState([...subgroupsState.filter(_subgroup => _subgroup.name !== subgroup.name), subgroup]);\n    }).catch(handleError);\n  };\n\n  const onSubgroupDelete = name => {\n    //alert('Not yet implemented in backend.');\n    backend.subgroupDelete(name).then(response => {\n      setSubgroupsState([...subgroupsState.filter(subgroup => subgroup.name !== name)]);\n    });\n  };\n\n  const onSubgroupActivate = name => {\n    const subgroup = subgroupsState.find(subgroup => subgroup.name === name); //console.log(subgroup);\n\n    onFilterChanged({ ...filterState,\n      constraints: subgroup === null || subgroup === void 0 ? void 0 : subgroup.constraints\n    });\n  };\n\n  const onControlsChanged = (identifier, controls) => {\n    setUpdating(identifier);\n    const newControls = { ...plotControlsState[identifier].controls,\n      ...controls\n    };\n    const newPlotControls = { ...plotControlsState,\n      ...{\n        [identifier]: { ...plotsState[identifier],\n          controls: newControls\n        }\n      }\n    }; //console.log()\n\n    setPlotControlsState(newPlotControls);\n    utilities.devLog('new controls:', newControls);\n    backend.controlsUpdate(newPlotControls[identifier].controls).then(figure => {\n      handleControlsUpdateResponse(identifier, figure);\n    }).catch(handleError);\n  }; // HELPER (see first part above)\n\n\n  const handleError = error => {\n    console.log(error);\n\n    try {\n      setErrorText(`${error.toJSON().name}: ${error.toJSON().message}`);\n    } catch (e) {\n      setErrorText('ERROR: unknown');\n    }\n\n    setErrorState(true);\n    const newState = {};\n    Object.keys(plotControlsState).forEach(identifier => {\n      newState[identifier] = false;\n    });\n    setUpdatingState(newState);\n  };\n\n  const handleControlsUpdateResponse = (identifier, figure) => {\n    setPlotsState({ ...plotsState,\n      [identifier]: { ...plotsState[identifier],\n        data: figure.data || [],\n        layout: figure.layout || {}\n      }\n    });\n    utilities.devLog(identifier, 'done');\n    setUpdatingState({ ...updatingState,\n      [identifier]: false\n    });\n  };\n\n  const handleFilterUpdateResponse = figures => {\n    const identifiers = Object.keys(figures);\n    const newPlotsState = { ...plotsState\n    };\n    const newUpdatingState = { ...updatingState\n    };\n    identifiers.forEach(identifier => {\n      newPlotsState[identifier] = {\n        data: figures[identifier].data || [],\n        layout: figures[identifier].layout || {}\n      };\n      newUpdatingState[identifier] = false;\n    });\n    setPlotsState(newPlotsState);\n    setUpdatingState(newUpdatingState);\n  };\n\n  const forceResize = () => {\n    // Workaround to trigger plot resize\n    window.dispatchEvent(new Event('resize'));\n  };\n\n  const createGridItem = identifier => {\n    return {\n      i: identifier,\n      x: gridItemsState.length * 5 % gridResponsiveState.cols,\n      y: Infinity,\n      w: 5,\n      h: 4\n    };\n  };\n\n  const createInitialPlotControlsState = identifier => {\n    return {\n      controls: { ...initialControls,\n        identifier\n      }\n    };\n  };\n\n  const setUpdating = identifier => {\n    if (identifier) {\n      setUpdatingState({ ...updatingState,\n        [identifier]: true\n      });\n    } else {\n      const newState = {};\n      Object.keys(plotControlsState).forEach(identifier => {\n        newState[identifier] = true;\n      });\n      setUpdatingState(newState);\n    }\n  }; // RENDER\n\n\n  const createGridItemElement = item => {\n    var _plotsState$item$i, _plotsState$item$i2;\n\n    return /*#__PURE__*/React.createElement(Card, {\n      key: item.i,\n      \"data-grid\": item,\n      className: `grid__item ${viewerState.activePlot === item.i ? ' grid__item--active' : ''}`,\n      onClick: () => {\n        onGridItemEdit(item.i);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 608,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"grid__item-header grid--draggable\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 618,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(IconButton, {\n      size: \"small\",\n      \"aria-label\": \"edit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 619,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(EditIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 624,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(IconButton, {\n      size: \"small\",\n      \"aria-label\": \"close\",\n      onClick: () => {\n        onGridItemRemove(item.i);\n      },\n      className: \"grid__item--close\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 626,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(CloseIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 634,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"grid__item-loader\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 637,\n        columnNumber: 9\n      }\n    }, updatingState[item.i] && /*#__PURE__*/React.createElement(LinearProgress, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 638,\n        columnNumber: 37\n      }\n    })), /*#__PURE__*/React.createElement(CardContent, {\n      className: \"grid__item-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 640,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Plot, {\n      identifier: item.i,\n      data: (_plotsState$item$i = plotsState[item.i]) === null || _plotsState$item$i === void 0 ? void 0 : _plotsState$item$i.data,\n      layout: (_plotsState$item$i2 = plotsState[item.i]) === null || _plotsState$item$i2 === void 0 ? void 0 : _plotsState$item$i2.layout,\n      onSelected: onPlotSelected,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 641,\n        columnNumber: 11\n      }\n    })));\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 653,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"toolbar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 654,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"toolbar__left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 655,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onGridItemAdd,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(AddIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 660,\n        columnNumber: 24\n      }\n    }),\n    title: \"Add new diagram\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 656,\n      columnNumber: 11\n    }\n  }, \"Add\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: forceResize,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(AspectRatioIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 670,\n        columnNumber: 24\n      }\n    }),\n    title: \"Force resize\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 666,\n      columnNumber: 11\n    }\n  }, \"Resize\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: onReset,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(ReplayIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 680,\n        columnNumber: 24\n      }\n    }),\n    title: \"Reset session\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 676,\n      columnNumber: 11\n    }\n  }, \"Reset session\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"toolbar__right\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 687,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: onViewerConfigurationToggle,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(SettingsIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 692,\n        columnNumber: 24\n      }\n    }),\n    title: \"Toggle configuration panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 688,\n      columnNumber: 11\n    }\n  }, \"Configuration\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: onViewerFilterToggle,\n    variant: \"contained\",\n    color: \"primary\",\n    startIcon: /*#__PURE__*/React.createElement(FilterListIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 702,\n        columnNumber: 24\n      }\n    }),\n    title: \"Toggle filter panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 698,\n      columnNumber: 11\n    }\n  }, \"Filter\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 709,\n      columnNumber: 7\n    }\n  }, viewerState.filtersVisible && /*#__PURE__*/React.createElement(Filter, {\n    filter: filterState,\n    subgroups: subgroupsState,\n    onFilterChanged: onFilterChanged,\n    onSubgroupDefine: onSubgroupDefine,\n    onSubgroupDelete: onSubgroupDelete,\n    onSubgroupActivate: onSubgroupActivate,\n    onClose: onViewerFilterToggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 711,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"scrollContainer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 721,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    breakpointCols: {\n      lg: 12,\n      md: 10,\n      sm: 6,\n      xs: 4,\n      xxs: 2\n    },\n    rowHeight: 100,\n    layouts: gridLayoutsState,\n    onBreakpointChange: onGridBreakpointChange,\n    onLayoutChange: onGridLayoutChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 722,\n      columnNumber: 9\n    }\n  }, gridItemsState.map(item => createGridItemElement(item)))), viewerState.controlsVisible && /*#__PURE__*/React.createElement(Configuration, {\n    controls: (_plotControlsState$vi = plotControlsState[viewerState.activePlot]) === null || _plotControlsState$vi === void 0 ? void 0 : _plotControlsState$vi.controls,\n    onControlsChanged: onControlsChanged,\n    onClose: onViewerConfigurationToggle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 735,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Snackbar, {\n    open: errorState,\n    autoHideDuration: 10000,\n    onClose: () => {\n      setErrorState(false);\n    },\n    anchorOrigin: {\n      vertical: 'top',\n      horizontal: 'right'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 743,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Alert, {\n    variant: \"filled\",\n    severity: \"error\",\n    onClose: () => {\n      setErrorState(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 751,\n      columnNumber: 9\n    }\n  }, errorText)));\n};\n\nexport default Viewer;","map":{"version":3,"sources":["/Users/philippwegner/Desktop/UKB/git/PostIDSN-Viewer/src/containers/Viewer.tsx"],"names":["React","useState","useEffect","Grid","Plot","localStorage","backend","Fit","Legend","utilities","Filter","defaultConcept","Configuration","DiagramType","initialDiagramType","Visit","Button","Card","CardContent","IconButton","LinearProgress","AddIcon","AspectRatioIcon","ReplayIcon","SettingsIcon","FilterListIcon","EditIcon","CloseIcon","Alert","Snackbar","initialControls","identifier","type","attX","attY","attC","dt","visit","all","followup","tolerance","norm","stack","fit","none","legend","bins","Viewer","props","Datatype","attributes","setAttributes","getTooltip","attribute_","forEach","attr","console","log","find","attribute","filter","datatypes","Object","values","findIndex","datatype","errorState","setErrorState","errorText","setErrorText","loadingAttributes","setLoadeingAttributes","getAttributes","then","response","allAttributes","initialViewerState","controlsVisible","filtersVisible","activePlot","viewerState","setViewerState","gridLayoutsState","setGridLayoutsState","getObjectItem","setObjectItem","forceResize","gridItemsState","setGridItemsState","map","item","y","Infinity","initialResponsiveState","breakpoint","cols","gridResponsiveState","setGridResponsiveState","defaultFilterState","concept","constraints","filterState","setFilterState","subgroupsState","setSubgroupsState","plotControlsState","setPlotControlsState","plotsState","setPlotsState","updatingState","setUpdatingState","onGridBreakpointChange","onViewerConfigurationToggle","onViewerFilterToggle","onGridLayoutChange","layout","layouts","onGridItemAdd","generateIdentifier","newIdentifiers","keys","sessionInit","createGridItem","createInitialPlotControlsState","data","document","querySelector","scrollTo","top","scrollHeight","behavior","catch","handleError","onGridItemRemove","newPlotsState","i","newPlotControlsState","onGridItemEdit","onReset","sessionReset","onPlotSelected","range","items","setUpdating","newFilterState","Scatter","Histogram","Timeline","includes","controls","newXConstraint","lower","x","upper","constraintXIndex","constraint","push","newYConstraint","constraintYIndex","Bar","devLog","filterUpdate","figures","handleFilterUpdateResponse","onFilterChanged","filters","onSubgroupDefine","subgroup","subgroupDefine","name","_subgroup","onSubgroupDelete","subgroupDelete","onSubgroupActivate","onControlsChanged","newControls","newPlotControls","controlsUpdate","figure","handleControlsUpdateResponse","error","toJSON","message","e","newState","identifiers","newUpdatingState","window","dispatchEvent","Event","length","w","h","createGridItemElement","lg","md","sm","xs","xxs","vertical","horizontal"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Grid from '../components/Grid';\nimport Plot from '../components/Plot';\nimport localStorage from '../services/LocalStorage';\nimport backend, { Fit, Legend } from '../services/Backend';\nimport utilities from '../services/Utilities';\nimport Filter, { FilterState, defaultConcept, Subgroup } from './Filter';\nimport Configuration, {\n  ControlsState,\n  DiagramType,\n  initialDiagramType,\n  Visit,\n} from './Controls';\nimport { Figure } from 'react-plotly.js';\nimport { Datum } from 'plotly.js';\nimport Button from '@material-ui/core/Button';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport IconButton from '@material-ui/core/IconButton';\nimport LinearProgress from '@material-ui/core/LinearProgress';\nimport './Viewer.css';\nimport AddIcon from '@material-ui/icons/Add';\nimport AspectRatioIcon from '@material-ui/icons/AspectRatio';\nimport ReplayIcon from '@material-ui/icons/Replay';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport FilterListIcon from '@material-ui/icons/FilterList';\nimport EditIcon from '@material-ui/icons/Edit';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Alert from '@material-ui/lab/Alert';\nimport Snackbar from '@material-ui/core/Snackbar';\n\n\n// CONFIG\n\nexport const initialControls = {\n  identifier: '',\n  type: initialDiagramType,\n  attX: '',\n  attY: '',\n  attC: '',\n  dt: 0,\n  visit: Visit.all,\n  followup: 0,\n  tolerance: 0,\n  norm: false,\n  stack: false,\n  fit: Fit.none,\n  legend: Legend.legend,\n  bins: 0,\n};\n\n// PROPS\n\ninterface Props {}\n\nconst Viewer: React.FunctionComponent<Props> = props => {\n  // GET ATTRIBUTES METHODS\n\n  interface Attribute {\n    topic: string;\n    topicDescription: string;\n    umbrella: string;\n    umbrellaDescription: string;\n    attribute: string;\n    attributeDescription: string;\n    attributeTooltip: string;\n    datatype: string;\n    domain: string;\n    unit: string;\n  }\n  \n  enum Datatype {\n    date = 'date',\n    int = 'int',\n    float = 'float',\n    code = 'code',\n    subgroups = 'SUBGROUPS',\n    patients = 'PATIENTS',\n  }\n\n  const [attributes, setAttributes] = useState<Attribute[]>([]);\n  // PATIENTS and SUBGROUPS are added to attributes manually and have this values as datatype\n  \n  \n  const getTooltip = (attribute_: string): string => {\n      attributes.forEach(attr =>{console.log(attr)});\n    \n      return attributes ? attributes.find((attr: Attribute) => attr.attribute === attribute_)[\"attributeTooltip\"] : \"\";\n    \n  };\n  \n  const filter = (datatypes: Datatype[]): Attribute[] => {\n    return attributes.filter(\n      attribute =>\n        Object.values(datatypes).findIndex(\n          datatype => attribute.datatype === datatype,\n        ) !== -1,\n    );\n  };\n\n\n\n\n\n  // STATES\n\n  // errorState\n  const [errorState, setErrorState] = useState<boolean>();\n  const [errorText, setErrorText] = useState<string>('');\n\n  //\n\n\n  const [loadingAttributes, setLoadeingAttributes] = useState();\n\n  useEffect(()=>{\n    backend.getAttributes().then((response) =>{\n      setAttributes(response.allAttributes);\n    });\n  }, []);\n\n  // viewerState\n  const initialViewerState = {\n    controlsVisible: false,\n    filtersVisible: true,\n    activePlot: '',\n  };\n  const [viewerState, setViewerState] =\n    useState<{\n      controlsVisible: boolean;\n      filtersVisible: boolean;\n      activePlot: string;\n    }>(initialViewerState);\n  const [gridLayoutsState, setGridLayoutsState] =\n    useState<ReactGridLayout.Layouts>(\n      localStorage.getObjectItem('grid.layouts') ?? {},\n    );\n\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState, viewerState]);\n\n  // gridLayoutsState\n\n  useEffect(() => {\n    localStorage.setObjectItem('grid.layouts', gridLayoutsState);\n    forceResize();\n  }, [gridLayoutsState]);\n\n  // gridItemsState\n  const [gridItemsState, setGridItemsState] = useState<\n    ReactGridLayout.Layout[]\n  >(\n    (localStorage.getObjectItem('grid.items') ?? [])\n      // Workaround for bug in layout serialization - Infinity (and possibly others) gets saved as null\n      .map((item: ReactGridLayout.Layout) => {\n        return { ...item, y: item.y ?? Infinity };\n      }),\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('grid.items', gridItemsState);\n  }, [gridItemsState]);\n\n  // gridResponsiveState\n  const initialResponsiveState = { breakpoint: '', cols: 12 };\n  const [gridResponsiveState, setGridResponsiveState] = useState<{\n    breakpoint: string;\n    cols: number;\n  }>(initialResponsiveState);\n  useEffect(() => {\n    forceResize();\n  }, [gridResponsiveState]);\n\n  // filterState\n  const defaultFilterState: FilterState = {\n    concept: defaultConcept,\n    constraints: [],\n  };\n\n  const [filterState, setFilterState] = useState<FilterState>(\n    localStorage.getObjectItem('filter') ?? defaultFilterState,\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('filter', filterState);\n  }, [filterState]);\n\n  // subgroupsState\n  const [subgroupsState, setSubgroupsState] = useState<Subgroup[]>(\n    localStorage.getObjectItem('subgroups') ?? [],\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('subgroups', subgroupsState);\n  }, [subgroupsState]);\n\n  // plotControlsState\n  interface PlotControlsState {\n    [key: string]: { controls: ControlsState };\n  }\n\n  const [plotControlsState, setPlotControlsState] = useState<PlotControlsState>(\n    localStorage.getObjectItem('controls') ?? {},\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('controls', plotControlsState);\n  }, [plotControlsState]);\n\n  // plotsState\n  interface PlotState {\n    data: Plotly.Data[];\n    layout: Partial<Plotly.Layout>;\n  }\n  const [plotsState, setPlotsState] = useState<{ [key: string]: PlotState }>(\n    localStorage.getObjectItem('plots') ?? {},\n  );\n  useEffect(() => {\n    localStorage.setObjectItem('plots', plotsState);\n  }, [plotsState]);\n\n  // updatingState\n  interface UpdatingState {\n    [key: string]: boolean;\n  }\n  const [updatingState, setUpdatingState] = useState<UpdatingState>({});\n\n  // HANDLERS\n\n  const onGridBreakpointChange = (breakpoint: string, cols: number) => {\n    setGridResponsiveState({\n      breakpoint: breakpoint,\n      cols: cols,\n    });\n  };\n\n  const onViewerConfigurationToggle = () => {\n    setViewerState({\n      ...viewerState,\n      controlsVisible: !viewerState.controlsVisible,\n    });\n  };\n\n  const onViewerFilterToggle = () => {\n    setViewerState({\n      ...viewerState,\n      filtersVisible: !viewerState.filtersVisible,\n    });\n  };\n\n  const onGridLayoutChange = (\n    layout: ReactGridLayout.Layout[],\n    layouts: ReactGridLayout.Layouts,\n  ) => {\n    setGridLayoutsState(layouts);\n  };\n\n  const onGridItemAdd = () => {\n    const identifier = utilities.generateIdentifier();\n    const newIdentifiers = [...Object.keys(plotsState), identifier];\n    backend\n      .sessionInit(newIdentifiers)\n      .then(() => {\n        setGridItemsState([...gridItemsState, createGridItem(identifier)]);\n        setPlotControlsState({\n          ...plotControlsState,\n          ...{ [identifier]: createInitialPlotControlsState(identifier) },\n        });\n        setPlotsState({\n          ...plotsState,\n          ...{ [identifier]: { data: [], layout: {} } },\n        });\n        setViewerState({\n          ...viewerState,\n          activePlot: identifier,\n          controlsVisible: true,\n        });\n        document.querySelector(\".scrollContainer\")?.scrollTo({\n          top: document.querySelector(\".scrollContainer\")?.scrollHeight,\n          behavior: 'smooth'\n        });\n      })\n      .catch(handleError);\n  };\n\n  const onGridItemRemove = (identifier: string) => {\n    const newPlotsState = { ...plotsState };\n    delete newPlotsState[identifier];\n    backend\n      .sessionInit(Object.keys(newPlotsState))\n      .then(() => {\n        setGridItemsState(\n          gridItemsState.filter(\n            (item: ReactGridLayout.Layout) => item.i !== identifier,\n          ),\n        );\n        setPlotsState(newPlotsState);\n        const newPlotControlsState = { ...plotControlsState };\n        delete newPlotControlsState[identifier];\n        setPlotControlsState(newPlotControlsState);\n        if (viewerState.activePlot === identifier) {\n          setViewerState({\n            ...viewerState,\n            activePlot: '',\n            controlsVisible: false,\n          });\n        }\n      })\n      .catch(handleError);\n  };\n\n  const onGridItemEdit = (identifier: string) => {\n    setViewerState({\n      ...viewerState,\n      activePlot: identifier,\n      controlsVisible: true,\n    });\n  };\n\n  const onReset = () => {\n    backend\n      .sessionReset()\n      .then(() => {\n        setViewerState(initialViewerState);\n        setGridResponsiveState(initialResponsiveState);\n        localStorage.setObjectItem('grid.layouts', {});\n        setGridLayoutsState({});\n        localStorage.setObjectItem('grid.items', []);\n        setGridItemsState([]);\n        localStorage.setObjectItem('filter', defaultFilterState);\n        setFilterState(defaultFilterState);\n        localStorage.setObjectItem('controls', {});\n        setPlotControlsState({});\n        localStorage.setObjectItem('plots', {});\n        setPlotsState({});\n        localStorage.setObjectItem('subgroups', []);\n        setSubgroupsState([]);\n        \n      })\n      .catch(handleError);\n  };\n\n  const onPlotSelected = (\n    identifier: string,\n    range: Plotly.SelectionRange | undefined,\n    items: Datum[],\n  ) => {\n    if (!range) {\n      return;\n    }\n\n    setUpdating();\n    const newFilterState: FilterState = {\n      ...filterState,\n      constraints: [...filterState.constraints],\n    };\n    // Update/add x-constraint\n    if (\n      [\n        DiagramType.Scatter,\n        DiagramType.Histogram,\n        DiagramType.Timeline,\n      ].includes(plotControlsState[identifier].controls.type)\n    ) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: range.x[0],\n        upper: range.x[1],\n        items: [],\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(\n        constraint =>\n          constraint.attribute === plotControlsState[identifier].controls.attX,\n      );\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    }\n    // Update/add y-constraint\n    if (\n      [DiagramType.Scatter, DiagramType.Timeline].includes(\n        plotControlsState[identifier].controls.type,\n      )\n    ) {\n      const newYConstraint = {\n        attribute: plotControlsState[identifier].controls.attY,\n        lower: range.y[0],\n        upper: range.y[1],\n        items: [],\n      };\n      const constraintYIndex = newFilterState.constraints.findIndex(\n        constraint =>\n          constraint.attribute === plotControlsState[identifier].controls.attY,\n      );\n      if (constraintYIndex > -1) {\n        newFilterState.constraints[constraintYIndex] = newYConstraint;\n      } else {\n        newFilterState.constraints.push(newYConstraint);\n      }\n    }\n    // Update/add discrete constraint\n    if (\n      [DiagramType.Bar].includes(plotControlsState[identifier].controls.type)\n    ) {\n      const newXConstraint = {\n        attribute: plotControlsState[identifier].controls.attX,\n        lower: null,\n        upper: null,\n        items: items,\n      };\n      const constraintXIndex = newFilterState.constraints.findIndex(\n        constraint =>\n          constraint.attribute === plotControlsState[identifier].controls.attX,\n      );\n      if (constraintXIndex > -1) {\n        newFilterState.constraints[constraintXIndex] = newXConstraint;\n      } else {\n        newFilterState.constraints.push(newXConstraint);\n      }\n    }\n\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend\n      .filterUpdate(newFilterState)\n      .then((figures: { [key: string]: Partial<Figure> }) => {\n        handleFilterUpdateResponse(figures);\n      })\n      .catch(handleError);\n  };\n\n  const onFilterChanged = (filters: Partial<FilterState>) => {\n    setUpdating();\n    const newFilterState: FilterState = {\n      ...filterState,\n      ...filters,\n    };\n    setFilterState(newFilterState);\n    utilities.devLog('new filters:', newFilterState);\n    backend\n      .filterUpdate(newFilterState)\n      .then((figures: { [key: string]: Partial<Figure> }) => {\n        handleFilterUpdateResponse(figures);\n      })\n      .catch(handleError);\n  };\n\n  const onSubgroupDefine = (subgroup: Subgroup) => {\n    backend\n      .subgroupDefine(subgroup.name)\n      .then(() => {\n        setSubgroupsState([\n          ...subgroupsState.filter(\n            _subgroup => _subgroup.name !== subgroup.name,\n          ),\n          subgroup,\n        ]);\n\n\n        \n        \n\n      })\n      .catch(handleError);\n  };\n\n  const onSubgroupDelete = (name: string) => {\n    //alert('Not yet implemented in backend.');\n    backend.subgroupDelete(name).then(response =>{\n      setSubgroupsState([\n        ...subgroupsState.filter(subgroup => subgroup.name !== name),\n      ]);\n    });\n    \n  };\n  const onSubgroupActivate = (name: string) => {\n    const subgroup = subgroupsState.find(subgroup => subgroup.name === name);\n    //console.log(subgroup);\n    onFilterChanged({\n      ...filterState,\n      constraints: subgroup?.constraints,\n    });\n  };\n\n  const onControlsChanged = (\n    identifier: string,\n    controls: Partial<ControlsState>,\n  ) => {\n    setUpdating(identifier);\n    const newControls: ControlsState = {\n      ...plotControlsState[identifier].controls,\n      ...controls,\n    };\n    const newPlotControls = {\n      ...plotControlsState,\n      ...{\n        [identifier]: {\n          ...plotsState[identifier],\n          controls: newControls,\n        },\n      },\n    };\n    //console.log()\n    setPlotControlsState(newPlotControls);\n    utilities.devLog('new controls:', newControls);\n    backend\n      .controlsUpdate(newPlotControls[identifier].controls)\n      .then((figure: Partial<Figure>) => {\n        handleControlsUpdateResponse(identifier, figure);\n      })\n      .catch(handleError);\n  };\n\n  // HELPER (see first part above)\n\n  const handleError = (error: any) => {\n    console.log(error);\n    try {\n      setErrorText(`${error.toJSON().name}: ${error.toJSON().message}`);\n    } catch (e) {\n      setErrorText('ERROR: unknown');\n    }\n\n    setErrorState(true);\n    const newState: UpdatingState = {};\n      Object.keys(plotControlsState).forEach(identifier => {\n        newState[identifier] = false;\n      });\n      setUpdatingState(newState);\n  };\n\n  const handleControlsUpdateResponse = (\n    identifier: string,\n    figure: Partial<Figure>,\n  ) => {\n    setPlotsState({\n      ...plotsState,\n      [identifier]: {\n        ...plotsState[identifier],\n        data: figure.data || [],\n        layout: figure.layout || {},\n      },\n    });\n    utilities.devLog(identifier, 'done');\n    setUpdatingState({\n      ...updatingState,\n      [identifier]: false,\n    });\n  };\n\n  const handleFilterUpdateResponse = (figures: {\n    [key: string]: Partial<Figure>;\n  }) => {\n    const identifiers = Object.keys(figures);\n    const newPlotsState = { ...plotsState };\n    const newUpdatingState = { ...updatingState };\n    identifiers.forEach(identifier => {\n      newPlotsState[identifier] = {\n        data: figures[identifier].data || [],\n        layout: figures[identifier].layout || {},\n      };\n      newUpdatingState[identifier] = false;\n    });\n    setPlotsState(newPlotsState);\n    setUpdatingState(newUpdatingState);\n  };\n\n  const forceResize = () => {\n    // Workaround to trigger plot resize\n    window.dispatchEvent(new Event('resize'));\n  };\n\n  const createGridItem = (identifier: string): ReactGridLayout.Layout => {\n    return {\n      i: identifier,\n      x: (gridItemsState.length * 5) % gridResponsiveState.cols,\n      y: Infinity,\n      w: 5,\n      h: 4,\n    };\n  };\n\n  const createInitialPlotControlsState = (\n    identifier: string,\n  ): { controls: ControlsState } => {\n    return { controls: { ...initialControls, identifier } };\n  };\n\n  const setUpdating = (identifier?: string) => {\n    if (identifier) {\n      setUpdatingState({\n        ...updatingState,\n        [identifier]: true,\n      });\n    } else {\n      const newState: UpdatingState = {};\n      Object.keys(plotControlsState).forEach(identifier => {\n        newState[identifier] = true;\n      });\n      setUpdatingState(newState);\n    }\n  };\n\n  // RENDER\n\n  const createGridItemElement = (item: ReactGridLayout.Layout) => {\n    return (\n      <Card\n        key={item.i}\n        data-grid={item}\n        className={`grid__item ${\n          viewerState.activePlot === item.i ? ' grid__item--active' : ''\n        }`}\n        onClick={() => {\n          onGridItemEdit(item.i);\n        }}\n      >\n        <div className=\"grid__item-header grid--draggable\">\n          <IconButton\n            size=\"small\"\n            aria-label=\"edit\"\n            \n          >\n            <EditIcon />\n          </IconButton>\n          <IconButton\n            size=\"small\"\n            aria-label=\"close\"\n            onClick={() => {\n              onGridItemRemove(item.i);\n            }}\n            className=\"grid__item--close\"\n          >\n            <CloseIcon />\n          </IconButton>\n        </div>\n        <div className=\"grid__item-loader\">\n          {updatingState[item.i] && <LinearProgress />}\n        </div>\n        <CardContent className=\"grid__item-content\">\n          <Plot\n            identifier={item.i}\n            data={plotsState[item.i]?.data}\n            layout={plotsState[item.i]?.layout}\n            onSelected={onPlotSelected}\n          />\n        </CardContent>\n      </Card>\n    );\n  };\n\n  return (\n    <div className=\"container\">\n      <div className=\"toolbar\">\n        <div className=\"toolbar__left\">\n          <Button\n            onClick={onGridItemAdd}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<AddIcon />}\n            title=\"Add new diagram\"\n          >\n            Add\n          </Button>\n\n          <Button\n            onClick={forceResize}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<AspectRatioIcon />}\n            title=\"Force resize\"\n          >\n            Resize\n          </Button>\n\n          <Button\n            onClick={onReset}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<ReplayIcon />}\n            title=\"Reset session\"\n          >\n            Reset session\n          </Button>\n        </div>\n\n        <div className=\"toolbar__right\">\n          <Button\n            onClick={onViewerConfigurationToggle}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<SettingsIcon />}\n            title=\"Toggle configuration panel\"\n          >\n            Configuration\n          </Button>\n\n          <Button\n            onClick={onViewerFilterToggle}\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<FilterListIcon />}\n            title=\"Toggle filter panel\"\n          >\n            Filter\n          </Button>\n        </div>\n      </div>\n      <div className=\"row\">\n        {viewerState.filtersVisible && (\n          <Filter\n            filter={filterState}\n            subgroups={subgroupsState}\n            onFilterChanged={onFilterChanged}\n            onSubgroupDefine={onSubgroupDefine}\n            onSubgroupDelete={onSubgroupDelete}\n            onSubgroupActivate={onSubgroupActivate}\n            onClose={onViewerFilterToggle}\n          />\n        )}\n        <div className=\"scrollContainer\">\n        <Grid\n          breakpointCols={{ lg: 12, md: 10, sm: 6, xs: 4, xxs: 2 }}\n          rowHeight={100}\n          layouts={gridLayoutsState}\n          onBreakpointChange={onGridBreakpointChange}\n          onLayoutChange={onGridLayoutChange}\n        >\n          {gridItemsState.map((item: ReactGridLayout.Layout) =>\n            createGridItemElement(item),\n          )}\n        </Grid>\n        </div>\n        {viewerState.controlsVisible && (\n          <Configuration\n            controls={plotControlsState[viewerState.activePlot]?.controls}\n            onControlsChanged={onControlsChanged}\n            onClose={onViewerConfigurationToggle}\n          />\n        )}\n      </div>\n\n      <Snackbar\n        open={errorState}\n        autoHideDuration={10000}\n        onClose={() => {\n          setErrorState(false);\n        }}\n        anchorOrigin={{ vertical: 'top', horizontal: 'right' }}\n      >\n        <Alert\n          variant=\"filled\"\n          severity=\"error\"\n          onClose={() => {\n            setErrorState(false);\n          }}\n        >\n          {errorText}\n        </Alert>\n      </Snackbar>\n    </div>\n  );\n};\n\nexport default Viewer;\n"]},"metadata":{},"sourceType":"module"}