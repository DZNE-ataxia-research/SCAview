{"ast":null,"code":"var _jsxFileName = \"/Users/philippwegner/Desktop/UKB/git/PostIDSN-Viewer/src/containers/Filter.tsx\";\nimport React, { useState } from 'react';\nimport './Filter.css';\nimport Radio from '@material-ui/core/Radio';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport IconButton from '@material-ui/core/IconButton';\nimport * as Attributes from '../services/Attributes';\nimport CloseIcon from '@material-ui/icons/Close';\nimport DeleteIcon from '@material-ui/icons/Delete'; // STRUCTURES\n\nexport let Concept;\n\n(function (Concept) {\n  Concept[Concept[\"patient\"] = 1] = \"patient\";\n  Concept[Concept[\"visit\"] = 2] = \"visit\";\n})(Concept || (Concept = {}));\n\n// CONFIG\nexport const defaultConcept = Concept.patient;\nconst conceptOptions = [{\n  label: 'Patient',\n  value: Concept.patient\n}, {\n  label: 'Visit',\n  value: Concept.visit\n}]; // PROPS\n\nconst Filter = props => {\n  React.useEffect(() => {\n    onPropsChanged(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props]); // STATES\n  //constraintsTableState\n\n  const [constraintsTableState, setConstraintsTableState] = useState([]); //newSubgroupState\n\n  const [newSubgroupState, setNewSubgroupState] = useState(''); //checkRadioState\n\n  const [selectSubgroupState, setSelectSubgroupState] = useState(); // HANDLERS\n\n  const onPropsChanged = () => {\n    setConstraintsTableState(props.filter.constraints.map(constraint => {\n      return {\n        attribute: constraint.attribute,\n        lower: constraint.lower ? constraint.lower.toFixed(1) : '',\n        upper: constraint.upper ? constraint.upper.toFixed(1) : '',\n        items: constraint.items.join(', ')\n      };\n    }));\n  };\n\n  const onConstraintChanging = (attribute, constraint) => {\n    const newConstraint = {\n      attribute: '',\n      lower: '',\n      upper: '',\n      items: '',\n      ...constraintsTableState.find(constraint => constraint.attribute === attribute),\n      ...constraint\n    };\n    setConstraintsTableState([...constraintsTableState.filter(constraint => constraint.attribute !== attribute), newConstraint]);\n  };\n\n  const onConstraintsChanged = () => {\n    props.onFilterChanged({\n      constraints: constraintsTableState.map(constraint => {\n        return {\n          attribute: constraint.attribute,\n          lower: constraint.lower ? +constraint.lower : null,\n          upper: constraint.upper ? +constraint.upper : null,\n          items: constraint.items.length > 0 ? constraint.items.split(', ') : []\n        };\n      })\n    });\n  };\n\n  const onConstraintsReset = () => {\n    props.onFilterChanged({\n      constraints: []\n    });\n  };\n\n  const onConstraintRemove = attribute => {\n    props.onFilterChanged({\n      constraints: props.filter.constraints.filter(constraint => constraint.attribute !== attribute)\n    });\n  }; // HELPER\n  // RENDER\n\n\n  return /*#__PURE__*/React.createElement(Card, {\n    className: \"filter\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(CardHeader, {\n    subheader: \"Filter\",\n    action: /*#__PURE__*/React.createElement(IconButton, {\n      size: \"small\",\n      \"aria-label\": \"close\",\n      onClick: () => {\n        props.onClose();\n      },\n      className: \"grid__item--close\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(CloseIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 13\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(CardContent, {\n    className: \"filter__content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form__title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 9\n    }\n  }, \"Filter Settings\"), /*#__PURE__*/React.createElement(RadioGroup, {\n    row: true,\n    value: props.filter.concept,\n    onChange: event => {\n      props.onFilterChanged({\n        concept: +event.target.value\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 9\n    }\n  }, conceptOptions.map(concept => /*#__PURE__*/React.createElement(FormControlLabel, {\n    key: concept.value,\n    value: concept.value,\n    control: /*#__PURE__*/React.createElement(Radio, {\n      color: \"primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 24\n      }\n    }),\n    label: concept.label,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 13\n    }\n  }))), !!constraintsTableState.length && /*#__PURE__*/React.createElement(TableContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Table, {\n    size: \"small\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(TableHead, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(TableRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 19\n    }\n  }, \"Attribute\"), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 19\n    }\n  }, \"Lower\"), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 19\n    }\n  }, \"Upper\"), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 19\n    }\n  }, \"Items\"), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 19\n    }\n  }))), /*#__PURE__*/React.createElement(TableBody, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 15\n    }\n  }, constraintsTableState.map(constraint => /*#__PURE__*/React.createElement(TableRow, {\n    key: constraint.attribute,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 21\n    }\n  }, Attributes.getTooltip(constraint.attribute)), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    value: constraint.lower,\n    disabled: !!constraint.items,\n    onChange: event => {\n      onConstraintChanging(constraint.attribute, {\n        lower: event.target.value\n      });\n    },\n    onBlur: () => onConstraintsChanged(),\n    onKeyUp: event => {\n      if (event.key === 'Enter') {\n        onConstraintsChanged();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 23\n    }\n  })), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    value: constraint.upper,\n    disabled: !!constraint.items,\n    onChange: event => {\n      onConstraintChanging(constraint.attribute, {\n        upper: event.target.value\n      });\n    },\n    onBlur: () => onConstraintsChanged(),\n    onKeyUp: event => {\n      if (event.key === 'Enter') {\n        onConstraintsChanged();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 23\n    }\n  })), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    value: constraint.items,\n    disabled: !constraint.items,\n    onChange: event => {\n      onConstraintChanging(constraint.attribute, {\n        items: event.target.value\n      });\n    },\n    onBlur: () => onConstraintsChanged(),\n    onKeyUp: event => {\n      if (event.key === 'Enter') {\n        onConstraintsChanged();\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 23\n    }\n  })), /*#__PURE__*/React.createElement(TableCell, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    size: \"small\",\n    \"aria-label\": \"remove\",\n    onClick: () => {\n      onConstraintRemove(constraint.attribute);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(DeleteIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 25\n    }\n  })))))))), /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    size: \"small\",\n    onClick: onConstraintsReset,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 9\n    }\n  }, \"Reset filters\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form__title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 9\n    }\n  }, \"Subgroup Definitions\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"input-group\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    value: newSubgroupState,\n    label: \"Name\",\n    onChange: event => {\n      setNewSubgroupState(event.target.value);\n    },\n    InputLabelProps: {\n      shrink: true\n    },\n    onKeyUp: event => {\n      if (event.key === 'Enter') {\n        props.onSubgroupDefine({\n          name: newSubgroupState,\n          constraints: props.filter.constraints\n        });\n        setNewSubgroupState('');\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    size: \"small\",\n    onClick: () => {\n      props.onSubgroupDefine({\n        name: newSubgroupState,\n        constraints: props.filter.constraints\n      });\n      setNewSubgroupState('');\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 11\n    }\n  }, \"Define\")), !!props.subgroups.length && /*#__PURE__*/React.createElement(RadioGroup, {\n    onChange: event => {\n      const subgroup = props.subgroups.find(subgroup => subgroup.name === event.target.value);\n      setSelectSubgroupState(subgroup);\n      props.onSubgroupActivate(event.target.value);\n    },\n    className: \"subgroups\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 11\n    }\n  }, props.subgroups.map(subgroup => /*#__PURE__*/React.createElement(FormControlLabel, {\n    key: subgroup.name,\n    value: subgroup.name,\n    control: /*#__PURE__*/React.createElement(Radio, {\n      color: \"primary\",\n      checked: subgroup === selectSubgroupState,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 26\n      }\n    }),\n    label: /*#__PURE__*/React.createElement(\"div\", {\n      className: \"subgroup__label\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 21\n      }\n    }, subgroup.name), /*#__PURE__*/React.createElement(IconButton, {\n      size: \"small\",\n      \"aria-label\": \"remove\",\n      onClick: () => {\n        props.onSubgroupDelete(subgroup.name);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(DeleteIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 23\n      }\n    }))),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 15\n    }\n  })))));\n};\n\nexport default Filter;","map":{"version":3,"sources":["/Users/philippwegner/Desktop/UKB/git/PostIDSN-Viewer/src/containers/Filter.tsx"],"names":["React","useState","Radio","RadioGroup","FormControlLabel","Button","TextField","Table","TableBody","TableCell","TableContainer","TableHead","TableRow","Card","CardContent","CardHeader","IconButton","Attributes","CloseIcon","DeleteIcon","Concept","defaultConcept","patient","conceptOptions","label","value","visit","Filter","props","useEffect","onPropsChanged","constraintsTableState","setConstraintsTableState","newSubgroupState","setNewSubgroupState","selectSubgroupState","setSelectSubgroupState","filter","constraints","map","constraint","attribute","lower","toFixed","upper","items","join","onConstraintChanging","newConstraint","find","onConstraintsChanged","onFilterChanged","length","split","onConstraintsReset","onConstraintRemove","onClose","concept","event","target","getTooltip","key","shrink","onSubgroupDefine","name","subgroups","subgroup","onSubgroupActivate","onSubgroupDelete"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport './Filter.css';\nimport Radio from '@material-ui/core/Radio';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Card from '@material-ui/core/Card';\nimport CardContent from '@material-ui/core/CardContent';\nimport CardHeader from '@material-ui/core/CardHeader';\nimport IconButton from '@material-ui/core/IconButton';\nimport * as Attributes from '../services/Attributes';\nimport { Datum } from 'plotly.js';\nimport CloseIcon from '@material-ui/icons/Close';\nimport DeleteIcon from '@material-ui/icons/Delete';\n\n// STRUCTURES\n\nexport enum Concept {\n  patient = 1,\n  visit = 2,\n}\n\ninterface Constraint {\n  attribute: string;\n  lower: number | null;\n  upper: number | null;\n  items: Datum[];\n}\n\ninterface ConstraintRow {\n  attribute: string;\n  lower: string;\n  upper: string;\n  items: string;\n}\n\nexport interface Subgroup {\n  name: string;\n  constraints: Constraint[];\n}\n\nexport interface FilterState {\n  concept: Concept;\n  constraints: Constraint[];\n}\n\n// CONFIG\n\nexport const defaultConcept = Concept.patient;\n\nconst conceptOptions = [\n  { label: 'Patient', value: Concept.patient },\n  { label: 'Visit', value: Concept.visit },\n];\n\n// PROPS\n\ninterface Props {\n  filter: FilterState;\n  subgroups: Subgroup[];\n  onFilterChanged: (filter: Partial<FilterState>) => void;\n  onSubgroupDefine: (subgroup: Subgroup) => void;\n  onSubgroupDelete: (name: string) => void;\n  onSubgroupActivate: (name: string) => void;\n  onClose: () => void;\n}\n\nconst Filter: React.FunctionComponent<Props> = props => {\n  React.useEffect(() => {\n    onPropsChanged();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props]);\n\n  // STATES\n\n  //constraintsTableState\n  const [constraintsTableState, setConstraintsTableState] = useState<\n    ConstraintRow[]\n  >([]);\n\n  //newSubgroupState\n  const [newSubgroupState, setNewSubgroupState] = useState<string>('');\n\n  //checkRadioState\n  const [selectSubgroupState, setSelectSubgroupState] = useState<Subgroup>();\n\n  // HANDLERS\n\n  const onPropsChanged = () => {\n    \n    setConstraintsTableState(\n      props.filter.constraints.map(constraint => {\n        return {\n          attribute: constraint.attribute,\n          lower: constraint.lower ? constraint.lower.toFixed(1) : '',\n          upper: constraint.upper ? constraint.upper.toFixed(1) : '',\n          items: constraint.items.join(', '),\n        };\n      }),\n    );\n  };\n\n  const onConstraintChanging = (\n    attribute: string,\n    constraint: Partial<ConstraintRow>,\n  ) => {\n    const newConstraint: ConstraintRow = {\n      attribute: '',\n      lower: '',\n      upper: '',\n      items: '',\n      ...constraintsTableState.find(\n        constraint => constraint.attribute === attribute,\n      ),\n      ...constraint,\n    };\n    setConstraintsTableState([\n      ...constraintsTableState.filter(\n        constraint => constraint.attribute !== attribute,\n      ),\n      newConstraint,\n    ]);\n  };\n\n  const onConstraintsChanged = () => {\n    props.onFilterChanged({\n      constraints: constraintsTableState.map(constraint => {\n        return {\n          attribute: constraint.attribute,\n          lower: constraint.lower ? +constraint.lower : null,\n          upper: constraint.upper ? +constraint.upper : null,\n          items:\n            constraint.items.length > 0 ? constraint.items.split(', ') : [],\n        };\n      }),\n    });\n  };\n\n  const onConstraintsReset = () => {\n    props.onFilterChanged({ constraints: [] });\n  };\n\n  const onConstraintRemove = (attribute: string) => {\n    props.onFilterChanged({\n      constraints: props.filter.constraints.filter(\n        constraint => constraint.attribute !== attribute,\n      ),\n    });\n  };\n\n  // HELPER\n\n  // RENDER\n\n  return (\n    <Card className=\"filter\">\n      <CardHeader\n        subheader=\"Filter\"\n        action={\n          <IconButton\n            size=\"small\"\n            aria-label=\"close\"\n            onClick={() => {\n              props.onClose();\n            }}\n            className=\"grid__item--close\"\n          >\n            <CloseIcon />\n          </IconButton>\n        }\n      />\n      <CardContent className=\"filter__content\">\n        <div className=\"form__title\">Filter Settings</div>\n        <RadioGroup\n          row\n          value={props.filter.concept}\n          onChange={event => {\n            props.onFilterChanged({ concept: +event.target.value });\n          }}\n        >\n          {conceptOptions.map(concept => (\n            <FormControlLabel\n              key={concept.value}\n              value={concept.value}\n              control={<Radio color=\"primary\" />}\n              label={concept.label}\n            />\n          ))}\n        </RadioGroup>\n        {!!constraintsTableState.length && (\n          <TableContainer>\n            <Table size=\"small\">\n              <TableHead>\n                <TableRow>\n                  <TableCell>Attribute</TableCell>\n                  <TableCell>Lower</TableCell>\n                  <TableCell>Upper</TableCell>\n                  <TableCell>Items</TableCell>\n                  <TableCell></TableCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {constraintsTableState.map(constraint => (\n                  <TableRow key={constraint.attribute}>\n                    <TableCell>\n                      {Attributes.getTooltip(constraint.attribute)}\n                    </TableCell>\n                    <TableCell>\n                      <TextField\n                        value={constraint.lower}\n                        disabled={!!constraint.items}\n                        onChange={event => {\n                          onConstraintChanging(constraint.attribute, {\n                            lower: event.target.value,\n                          });\n                        }}\n                        onBlur={() => onConstraintsChanged()}\n                        onKeyUp={event => {\n                          if (event.key === 'Enter') {\n                            onConstraintsChanged();\n                          }\n                        }}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      <TextField\n                        value={constraint.upper}\n                        disabled={!!constraint.items}\n                        onChange={event => {\n                          onConstraintChanging(constraint.attribute, {\n                            upper: event.target.value,\n                          });\n                        }}\n                        onBlur={() => onConstraintsChanged()}\n                        onKeyUp={event => {\n                          if (event.key === 'Enter') {\n                            onConstraintsChanged();\n                          }\n                        }}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      <TextField\n                        value={constraint.items}\n                        disabled={!constraint.items}\n                        onChange={event => {\n                          onConstraintChanging(constraint.attribute, {\n                            items: event.target.value,\n                          });\n                        }}\n                        onBlur={() => onConstraintsChanged()}\n                        onKeyUp={event => {\n                          if (event.key === 'Enter') {\n                            onConstraintsChanged();\n                          }\n                        }}\n                      />\n                    </TableCell>\n                    <TableCell>\n                      <IconButton\n                        size=\"small\"\n                        aria-label=\"remove\"\n                        onClick={() => {\n                          onConstraintRemove(constraint.attribute);\n                        }}\n                      >\n                        <DeleteIcon />\n                      </IconButton>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </TableContainer>\n        )}\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          size=\"small\"\n          onClick={onConstraintsReset}\n        >\n          Reset filters\n        </Button>\n        <div className=\"form__title\">Subgroup Definitions</div>\n        <div className=\"input-group\">\n          <TextField\n            value={newSubgroupState}\n            label=\"Name\"\n            onChange={event => {\n              setNewSubgroupState(event.target.value);\n            }}\n            InputLabelProps={{\n              shrink: true,\n            }}\n            onKeyUp={event => {\n              if (event.key === 'Enter') {\n                props.onSubgroupDefine({\n                  name: newSubgroupState,\n                  constraints: props.filter.constraints,\n                });\n                setNewSubgroupState('');\n              }\n            }}\n          />\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            size=\"small\"\n            onClick={() => {\n              props.onSubgroupDefine({\n                name: newSubgroupState,\n                constraints: props.filter.constraints,\n              });\n              setNewSubgroupState('');\n            }}\n          >\n            Define\n          </Button>\n        </div>\n        {!!props.subgroups.length && (\n          <RadioGroup\n            onChange={event => {\n              const subgroup = props.subgroups.find(subgroup => subgroup.name === event.target.value);\n              setSelectSubgroupState(subgroup);\n              props.onSubgroupActivate(event.target.value);\n            }}\n            className=\"subgroups\"\n          >\n            {props.subgroups.map(subgroup => (\n              <FormControlLabel\n                key={subgroup.name}\n                value={subgroup.name}\n                control={<Radio color=\"primary\" checked={subgroup === selectSubgroupState}/>}\n                label={\n                  <div className=\"subgroup__label\">\n                    <span>{subgroup.name}</span>\n                    <IconButton\n                      size=\"small\"\n                      aria-label=\"remove\"\n                      onClick={() => {\n                        props.onSubgroupDelete(subgroup.name);\n                      }}\n                    >\n                      <DeleteIcon />\n                    </IconButton>\n                  </div>\n                }\n              />\n            ))}\n          </RadioGroup>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default Filter;\n"]},"metadata":{},"sourceType":"module"}